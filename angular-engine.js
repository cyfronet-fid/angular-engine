"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}angular.module("engine.common",[]),angular.module("engine.dashboard",["ngRoute","engine.list"]),angular.module("engine.document",["ngRoute"]),angular.module("engine.steps",["ngRoute"]);var app=angular.module("engine",["ngRoute","ngResource","formly","engine.formly","ui.bootstrap","checklist-model","engine.common","engine.list","engine.dashboard","engine.steps","ngMessages","ngFileUpload","pascalprecht.translate","engine.document"]);app.config(["formlyConfigProvider","formlyApiCheck","$engLogProvider","$provide","productionMode",function(formlyConfigProvider,formlyApiCheck,$engLogProvider,$provide,productionMode){formlyApiCheck.config.disabled=!0,formlyConfigProvider.disableWarnings=!0,formlyConfigProvider.extras.ngModelAttrsManipulatorPreferBound=!0,productionMode&&$engLogProvider.setLogLevel("error")}]),app.run(["$engine","$rootScope","$engLog","$translate",function($engine,$rootScope,$engLog,$translate){function onRelad(){$engLog.debug("engine.common.navigateAway");var event=$rootScope.$broadcast("engine.common.navigateAway");return 1==event.defaultPrevented||null}0==$engine.disableOnReload&&(window.onbeforeunload=onRelad,$rootScope.$on("$locationChangeStart",function(event,next,current){var nextBase=next.match(/^[^?]+/),currBase=current.match(/^[^?]+/);1==nextBase.length&&1==currBase.length&&currBase[0]==nextBase[0]||1==onRelad()&&0==confirm($translate.instant("Do you want to leave this site? Changes you made may not be saved."))&&event.preventDefault()}))}]),angular.module("engine.formly",["ui.select","ngSanitize"]),angular.module("engine.list",["ngRoute"]),app=angular.module("engine.common"),app.component("actionButton",{controller:["$q",function($q){var self=this;this.loading=!1,this.invoke=function(){this.loading||(this.loading=!0,$q.when(this.onClick())["finally"](function(){self.loading=!1}))}}],templateUrl:"/src/common/action-button/action-button.tpl.html",bindings:{onClick:"&",label:"@",btnClass:"@"}}),angular.module("engine.common").constant("ENGINE_SAVE_ACTIONS",["CREATE","UPDATE"]);var app=angular.module("engine.common");app.directive("engIsolateForm",["$timeout",function($timeout){return{restrict:"A",require:"?form",link:function(scope,$element,attrs,formController){formController&&$timeout(function(){var parentFormController=$element.parent().controller("form");if(!_.isUndefined(parentFormController)){parentFormController.$removeControl(formController);var isolateFormCtrl={$addControl:angular.noop,$removeControl:angular.noop,$setValidity:angular.noop,$setDirty:angular.noop,$setPristine:angular.noop};angular.extend(formController,isolateFormCtrl)}})}}}]),angular.module("engine.common").factory("DocumentEventCtx",function(){return function(document,action,options){this.document=document,this.action=document,this.options=options}}).factory("ErrorEventCtx",function(){return function(errorId,errorMessage){this.errorId=errorId,this.errorMessage=errorMessage}}).factory("engineActionUtils",["$rootScope","ErrorEventCtx","ENGINE_SAVE_ACTIONS",function($rootScope,ErrorEventCtx,ENGINE_SAVE_ACTIONS){var ENGINE_LINK_ACTION="LINK",isSaveAction=function(action){return!!_.contains(ENGINE_SAVE_ACTIONS,action.type)},isLinkAction=function(action){return action.type==ENGINE_LINK_ACTION},getLinkAction=function(actions){return _.find(actions,isLinkAction)},getCreateUpdateAction=function(actions){if(null!=actions)for(var i=0;i<actions.length;++i){var action=actions[i];if(isSaveAction(action))return action}return $rootScope.$broadcast("engine.common.error",new ErrorEventCtx("noCreateUpdateAction","Document has no available create / update action, angular-engine framework requires that at least one update and one create action is specified")),null};return{getCreateUpdateAction:getCreateUpdateAction,isSaveAction:isSaveAction,getLinkAction:getLinkAction,isLinkAction:isLinkAction}}]);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),ConfirmModalCmpCtrl=function(){function ConfirmModalCmpCtrl(){_classCallCheck(this,ConfirmModalCmpCtrl)}return _createClass(ConfirmModalCmpCtrl,[{key:"$onInit",value:function(){}}]),ConfirmModalCmpCtrl}();app.component("confirmModalCmp",{bindings:{close:"&",dismiss:"&",resolve:"<"},controller:ConfirmModalCmpCtrl,templateUrl:"/src/common/confirm-modal/common.confirm-modal.tpl.html"});var app=angular.module("engine.common");app.factory("engConfirm",["$resource","$uibModal","$translate","$timeout","$engine",function($resource,$uibModal,$translate,$timeout,$engine){return function(_title,_content){var modalInstance=$uibModal.open({component:"confirmModalCmp",keyboard:!1,backdrop:"static",windowTopClass:$engine.GLOBAL_CSS,resolve:{title:function(){return _title},content:function(){return _content}},controller:ConfirmModalCmpCtrl,size:"sm"});return modalInstance.result}}]),angular.module("engine.common").component("engineDocumentActions",{templateUrl:"/src/common/document-actions/document-actions.tpl.html",controller:["$rootScope","$scope","DocumentActionList","$engLog","$timeout",function($rootScope,$scope,DocumentActionList,$engLog,$timeout){var self=this,_bindings=[];this.$onInit=function(){null!=self.document&&self.loadActions()},this.$onChanges=function(changesObj){if(null!=changesObj.documentScope&&(null==changesObj.documentScope.currentValue?($engLog.warn("engineDocumentActions document-scope argument not specified, using local $scope, which may be not what you want"),this._documentScope=$scope):this._documentScope=this.documentScope,1!=changesObj.documentScope.isFirstChange()&&null!=changesObj.documentScope.previousValue&&(angular.forEach(_bindings,function(removeBinding){removeBinding()}),_bindings=[]),_bindings.push(this._documentScope.$on("engine.common.document.documentLoaded",self.loadActions)),_bindings.push(this._documentScope.$on("document.form.requestReload",self.loadActions)),_bindings.push(this._documentScope.$on("engine.common.save.after",self.loadActions)),_bindings.push(this._documentScope.$on("engine.list.reload",self.loadActions))),null!=changesObj.document){var newDocument=changesObj.document.currentValue;null==self.actionList||_.isEmpty(newDocument)||null==newDocument||(null==self.actionList?self.loadActions():self.actionList._setDocument(newDocument))}},this.validate=function(){return this._documentScope.$emit("engine.common.document.validate").$promise},this.changeStep=function(newStep){self.step=newStep},this.loadActions=function(){self.loading=!0,$timeout(function(){if(null==self.document)return void(self.loading=!1);var document=_.clone(self.document);document.states=_.clone(self.document.states),document.states.documentModelId=self.options.documentModelType,self.actionList=new DocumentActionList(null,document,self.documentParent,self._documentScope),self.actionList.$ready["finally"](function(){self.loading=!1})})}}],bindings:{documentScope:"<",document:"<",options:"=",steps:"=",step:"=",showValidationButton:"=",customButtons:"=",documentParent:"=",dirty:"=",saveAlertLeft:"="}}),angular.module("engine.common").factory("engActionResource",["$engineConfig","$engineApiCheck","$resource","EngineInterceptor",function($engineConfig,$engineApiCheck,$resource,EngineInterceptor){var _action=$resource($engineConfig.baseUrl+"/action/invoke?documentId=:documentId&actionId=:actionId",{actionId:"@actionId",documentId:"@documentId"},{invoke:{method:"POST",transformResponse:EngineInterceptor.response,isArray:!1}}),_actionAvailable=$resource($engineConfig.baseUrl+"/action/available?documentId=:documentId",{documentId:"@id"},{post:{method:"POST",transformResponse:EngineInterceptor.response,isArray:!0}});return{getAvailable:function(document,documentId,otherDocumentId){return $engineApiCheck([$engineApiCheck.object,$engineApiCheck.string],arguments),_actionAvailable.post({documentId:documentId,otherDocumentId:otherDocumentId},null===document?null:_.omit(document,"$ext"))},invoke:function(actionId,document,contextDocumentId,otherDocumentId){return $engineApiCheck([$engineApiCheck.string,$engineApiCheck.object],arguments),_action.invoke({actionId:actionId,documentId:contextDocumentId||document.id,otherDocumentId:otherDocumentId},null===document?null:_.omit(document,"$ext"))}}}]);var _module=angular.module("engine.common");_module.directive("sidebarAddon",["$compile",function($compile){return{templateUrl:"/src/common/sidebar-addon/sidebar-addon.tpl.html",restrict:"E",scope:{tag:"@",document:"=",ctx:"=",caption:"@"},link:function($scope,$element,attrs){var newElement=$compile("<"+$scope.tag+' document="document" ctx="ctx"></'+$scope.tag+">")($scope);$element.children().eq(0).children().eq(0).append(newElement)}}}]),angular.module("engine.dashboard").controller("engineDashboardCtrl",["$scope","$route","$engine",function($scope,$route,$engine){$scope.$engine=$engine,$scope.options=$route.current.$$route.options,$scope.queries=$scope.options.queries,$scope.IMMEDIATE_CREATE=$engine.IMMEDIATE_CREATE}]),angular.module("engine.document").component("engineDocumentDetails",{templateUrl:"/src/document/details/details.tpl.html",controller:["$parse","$window","$scope",function($parse,$window,$scope){var _this=this,self=this;this.$parse=$parse,self.isVisible=function(){return $scope.$parent.sideMenuVisible},this.formatEntry=function(entry){var r=_this.$parse(entry.name)(_this.ngModel);return!_.isUndefined(r)&&_.isDate(r)&&"date"===entry.type&&(r=$filter("date")(r)),r},this.saveDocument=function(){return self.savePromise=self.actions.callSave(),self.savePromise}}],bindings:{ngModel:"<",options:"=",actions:"=",dirty:"="}}).filter("conditionFulfiled",["$parse",function($parse){return function(items,document){var filtered=[];return angular.forEach(items,function(item){null!=item.condition&&$parse(item.condition)(document)!==!0||filtered.push(item)}),filtered}}]).directive("scrollRwd",["$window","$document","$timeout",function($window,$document,$timeout){function link(scope,element,attrs){function updateScroll(){var marginBottom=10,elementHeight=element[0].scrollHeight,elementTop=element[0].getBoundingClientRect().top;if(elementHeight>0&&elementHeight+elementTop>scope.windowHeight){var heightToSave=scope.windowHeight-elementTop-marginBottom+"px";element.css("height",heightToSave),element.addClass("scroll-rwd")}else element.css("height","auto"),element.removeClass("scroll-rwd")}scope.windowHeight=$window.innerHeight,attrs.$observe("isVisible",function(val){val&&$timeout(function(){scope.windowHeight=$window.innerHeight,updateScroll()})}),angular.element($window).on("resize",function(){scope.windowHeight=$window.innerHeight,updateScroll(),scope.$digest()})}return{restrict:"AEC",link:link}}]);var app=angular.module("engine.document");app.component("engineDocument",{templateUrl:"/src/document/document.tpl.html",controller:"engineDocumentCtrl",bindings:{documentChange:"&",document:"=",options:"=",stepList:"=",step:"=",validatedSteps:"=",showValidationButton:"=",documentId:"@",actions:"=",parentDocument:"=",dirty:"=",processing:"=?",documentScope:"=?"}}),app.controller("engineDocumentCtrl",["$scope","$route","engineMetric","$routeParams","$engine","engineDocument","engineActionsAvailable","$location","engineActionUtils","DocumentEventCtx","engineAction","engineMetricCategories","StepList","DocumentForm","DocumentActionList","$q","$engLog","$attrs","Step","$parse","$element","$compile","$interval","$http",function($scope,$route,engineMetric,$routeParams,$engine,engineDocument,engineActionsAvailable,$location,engineActionUtils,DocumentEventCtx,engineAction,engineMetricCategories,StepList,DocumentForm,DocumentActionList,$q,$engLog,$attrs,Step,$parse,$element,$compile,$interval,$http){function _initDocument(noReloadSteps){return self.getDocument(noReloadSteps).then(function(){return $q.all(self.stepList.$ready,self.documentForm.$ready)}).then(self.initDocument).then(self.postinitDocument).then(function(){$engLog.debug("engineDocumentCtrl initialized: ",self),$engLog.log(self.$ready.$$state.status)}).then(self.validateAfterInit).then(function(){$scope.$emit("engine.common.document.documentLoaded",self.document)})}var self=this;$engLog.debug($scope),this.$onInit=function(){this.document=null,this.documentScope=$scope,$scope.steps=this.options.document.steps,this.processing=!1,this.actionList=null,this.documentForm=new DocumentForm($scope),this.dirty=!1,$scope.$on("engine.common.document.requestReload",function(event){$engLog.debug("request reload for document"),event.reloadPromise=self.getDocument(!0).then(function(){return self.stepList.setDocument(self.document),self.stepList.$ready}).then(function(){return self.documentForm._setDocument(self.document)}).then(function(){return self.documentForm.connectFieldToStep()}).then(function(){self.actionList._setDocument(self.document),$scope.$broadcast("engine.list.reload")})}),$scope.$on("engine.common.document.validate",function(event){event.$promise=self.documentForm.validate(null,!0).then(function(valid){valid||(self.step=self.stepList.getFirstInvalidIndex())})}),$scope.$on("engine.list.reload",function(event){self.loadMessages()}),$scope.$on("engine.common.document.requestSave",function(event){event.savePromise=self.save()}),$scope.$on("engine.common.action.after",function(event,document,action,result){self.loadMessages()}),$scope.$watch("$ctrl.formlyState.$dirty",function(newValue,oldValue){self.dirty=newValue}),$scope.$watch("$ctrl.formlyState",function(newValue,oldValue){self.documentForm.setFormlyState(newValue)}),$scope.$watch("$ctrl.formlyOptions",function(newValue,oldValue){self.documentForm.setFormlyOptions(newValue)}),this.$ready=_initDocument()},this.$onChanges=function(changesObject){_.isUndefined(changesObject.documentId)||(console.log("documentId changed",changesObject.documentId),""===changesObject.documentId.currentValue||changesObject.documentId.isFirstChange()||(self.document=null,self.processing=!1,self.actionList=null,self.dirty=!1,self.documentForm.$destroy(),self.formlyState=void 0,self.formlyOptions=void 0,self.documentForm=new DocumentForm($scope),self.$ready=_initDocument()))},this.loadMessages=function(){$http.get("/document/messages?documentId="+self.documentId).then(function(res){return self.messages=res.data.data})},this.getDocument=function(noReloadSteps){var _actionsToPerform=[];return self.documentId&&"new"!=self.documentId?_actionsToPerform.push(engineDocument.get(self.documentId).$promise.then(function(data){self.document=data.document,self.messages=data.messages})):(self.document=angular.copy(self.options.documentJSON),self.document.name=(self.options.name||"Document")+" initiated on "+new Date),$q.all(_actionsToPerform).then(function(){noReloadSteps||self.stepList.setDocument(self.document)})},this.initDocument=function(){var message="engineDocumentCtrl.initDocument called before all required dependencies were resolved, make sure that iniDocument is called after everything is loaded";assert(self.stepList.$ready,message),self.stepList.setCurrentStep(self.step);var document=_.clone(self.document);return document.states=_.clone(self.document.states),document.states.documentModelId=self.options.documentModelType,self.actionList=new DocumentActionList(null,document,self.parentDocument,$scope),$q.all([self.actionList.$ready]).then(function(){return $attrs.actions&&(self.actions=self.actionList),self.documentForm.init(self.document,self.options,self.stepList,self.actionList,self.formlyState,self.formlyOptions),self.documentForm.loadForm()})["catch"](function(error){return $engine.ERROR_HANDLER($location.hash(),error)})},this.postinitDocument=function(){null==self.actionList.getSaveAction()&&self.documentForm.setEditable(!1),$scope.$watch("$ctrl.step",self.onStepChange)},this.onStepChange=function(newStep,oldStep){newStep!=oldStep&&self.documentForm.isEditable()&&(self.documentForm.validate(oldStep,!0),self.save()),self.stepList.setCurrentStep(newStep),self.documentForm.setStep(newStep)},this.save=function(){return self.processing=!0,self.actionList.callSave()["finally"](function(){return self.processing=!1})},this.validateAfterInit=function(){var stepsToValidate=[],currentStep=self.stepList.getCurrentStepIndex();for(i=0;i<currentStep;i++)self.stepList.getStep(i).getState()==Step.STATE_BLANK&&stepsToValidate.push(i);self.documentForm.validate(stepsToValidate,!0)}}]),angular.module("engine.document").factory("DocumentModal",["$resource","$uibModal","$translate","$timeout","$engine",function($resource,$uibModal,$translate,$timeout,$engine){return function(_documentId,_documentOptions,parentDocument,callback){var modalInstance=$uibModal.open({templateUrl:"/src/document/document-modal.tpl.html",keyboard:!1,backdrop:"static",windowTopClass:$engine.GLOBAL_CSS,appendTo:$($engine.MODAL_CONTAINER).eq(0),controller:["$scope","documentId","documentOptions","engineActionsAvailable","StepList","engineResolve","$uibModalInstance",function($scope,documentId,documentOptions,engineActionsAvailable,StepList,engineResolve,$uibModalInstance){function _canCloseModal(){return 0==$scope.documentDirty||confirm($translate.instant("Do you want to close this modal? Changes you made have not been saved."))}$scope.engineResolve=engineResolve,$scope.step=0,$scope.documentOptions=documentOptions,$scope.documentScope=void 0,$scope.parentDocument=parentDocument,$scope.$scope=$scope,$scope.stepList=new StepList($scope.documentOptions.document.steps),$scope.document={},$scope.documentId=documentId;var registeredListeners=[];$scope.closeModal=function(){$uibModalInstance.close()},$scope.$on("modal.closing",function(event){_canCloseModal()||event.preventDefault()}),$scope.$watch("documentScope",function(nv,ov){null!=ov&&(_.each(registeredListeners,function(removeListener){removeListener()}),registeredListeners=[]),null!=nv&&(registeredListeners.push($scope.documentScope.$on("engine.common.action.after",function(event,ctx){ctx.action.isSave()||ctx.action.isCreate()||"REDIRECT"==ctx.result.type&&(event.preventDefault(),$timeout($scope.closeModal))})),registeredListeners.push($scope.documentScope.$on("engine.common.save.after",function(event,ctx){console.log(event,ctx),ctx.action.isCreate()===!0&&"REDIRECT"===ctx.result.type&&($scope.stepList=new StepList($scope.documentOptions.document.steps),$scope.document={},$scope.step=0,$scope.documentId=ctx.result.redirectToDocument)})))}),$scope.customButtons=[{label:"Close",action:$scope.closeModal}]}],size:"lg",resolve:{documentOptions:function(){return _documentOptions},documentId:function(){return _documentId}}});return modalInstance.result.then(function(result){callback&&callback(result)},function(){})}}]),angular.module("engine.document").controller("engineDocumentWrapperCtrl",["$scope","$route","$location","engineMetric","$routeParams","engineResolve","StepList","$engine",function($scope,$route,$location,engineMetric,$routeParams,engineResolve,StepList,$engine){$scope.responsive=$engine.RESPONSIVE,$scope.engineResolve=engineResolve,$scope.options=$route.current.$$route.options,$scope.stepList=new StepList($route.current.$$route.options.document.steps),$scope.document={},$scope.documentId=$routeParams.id,$scope.processing=!1,void 0===$routeParams.step?$routeParams.step=0:$routeParams.step=parseInt($routeParams.step),$scope.sideMenuVisible=!1,$scope.toggleSideMenu=function(){$scope.sideMenuVisible=!$scope.sideMenuVisible},$scope.$routeParams=$routeParams,$scope.conditionFulfilled=function(addon){return addon.condition($scope.document)},$scope.$watch("$routeParams.step",function(newVal,oldVal){angular.isString(newVal)&&(newVal=parseInt(newVal),$routeParams.step=newVal),($routeParams.step>$scope.stepList.steps.length-1||$routeParams.step<0)&&($routeParams.step=0,newVal=0),newVal!==oldVal&&$location.search({step:newVal||0})})}]).directive("fixedOnScroll",["$window",function($window){var $win=angular.element($window);return{restrict:"A",link:function(scope,element,attrs){var topClass=attrs.fixedOnScroll;$win.on("scroll",function(){scope.offsetTop=element[0].parentNode.offsetTop+element[0].getBoundingClientRect().top,$window.pageYOffset>=scope.offsetTop?element.addClass(topClass):element.removeClass(topClass),scope.$digest()})}}}]),angular.module("engine.document").filter("numberFormat",["$translate",function($translate){return function(item){var number=Number(item);return _.isNaN(number)?item:number.toLocaleString($translate.use())}}]),angular.module("engine.document").factory("DocumentActionList",["DocumentAction","engActionResource","$engineApiCheck","$q","$engLog","$http","$rootScope",function(DocumentAction,engActionResource,$engineApiCheck,$q,$engLog,$http,$rootScope){function DocumentActionList(actions,document,parentDocument,$scope,dontSendTemp){$engineApiCheck([$engineApiCheck.object,$engineApiCheck.object.optional,$engineApiCheck.object.optional],arguments),null==parentDocument&&(parentDocument={});var self=this;this.dontSendTemp=dontSendTemp||!1,this.$scope=$scope,this.parentDocument=parentDocument,this.parentDocumentId=null!=document.id?null:parentDocument.id,this.actions=[],this.markInit=null,this.loadActions=function(){return null!=actions?self.processActions(actions):engActionResource.getAvailable(self.document,self.document.id,self.parentDocumentId).$promise.then(self.processActions)},this.processActions=function(actions){self.actions=[],_.forEach(actions,function(action){self.actions.push(new DocumentAction(action,self.document,self.parentDocument,self.$scope,self.dontSendTemp))})},this.$ready=$q(function(resolve,reject){self.markInit=resolve}).then(self.loadActions),this._setDocument(document)}return DocumentActionList.get=function(document,parentDocument,$scope){var res=new DocumentActionList(document,parentDocument,$scope);return $http.get($engineConfig.baseUrl+"/action/available?documentId="+document.id).then(function(response){var data=response.data.data;return data}),res},DocumentActionList.prototype._setDocument=function(document){if(null!=document&&!_.isEmpty(document)&&document!=this.document){this.document;this.document=document,this.parentDocumentId=document.id?null:this.parentDocumentId,this.markInit(),this.$ready=this.loadActions()}},DocumentActionList.prototype.getSaveAction=function(){return _.find(this.actions,function(action){return action.isSave()})},DocumentActionList.prototype.getLinkAction=function(){return _.find(this.actions,function(action){return action.isLink()})},DocumentActionList.prototype.callSave=function(){var saveAction=this.getSaveAction();return null==saveAction?($engLog.warn("engine.document.actions No save action specified for document",this.document),$q.reject()):($engLog.debug("engine.document.actions Called save for document",this.document),saveAction.call())},DocumentActionList.prototype.callLink=function(){var linkAction=this.getLinkAction();return null==linkAction?($engLog.warn("engine.document.actions No link action specified for document",this.document),$q.reject()):($engLog.debug("engine.document.actions Called link for document",this.document),linkAction.call())},DocumentActionList}]).factory("DocumentAction",["engActionResource","$engineApiCheck","DocumentActionProcess","$engLog","$q","$rootScope","$engine",function(engActionResource,$engineApiCheck,DocumentActionProcess,$engLog,$q,$rootScope,$engine){function DocumentAction(engAction,document,parentDocument,$scope,dontSendTemp){$engineApiCheck([$engineApiCheck.object,$engineApiCheck.object,$engineApiCheck.object.optional,$engineApiCheck.object.optional],arguments),this.dontSendTemp=dontSendTemp||!1,this.document=document,this.actionId=engAction.id,this.label=engAction.label,this.engAction=engAction,this.type=engAction.type,this.parentDocument=parentDocument,this.parentDocumentId=null==parentDocument?null:parentDocument.id,this.$scope=$scope}return DocumentAction.prototype.TYPE_CREATE="CREATE",DocumentAction.prototype.TYPE_UPDATE="UPDATE",DocumentAction.prototype.TYPE_DELETE="DELETE",DocumentAction.prototype.TYPE_LINK="LINK",DocumentAction.prototype.SAVE_ACTIONS=[DocumentAction.prototype.TYPE_CREATE,DocumentAction.prototype.TYPE_UPDATE],DocumentAction.prototype.LINK_ACTIONS=[DocumentAction.prototype.TYPE_LINK],DocumentAction.prototype.DELETE_ACTIONS=[DocumentAction.prototype.TYPE_DELETE],DocumentAction.prototype.broadcastNotification=function(notificationId){$rootScope.$broadcast(notificationId,this.document,this)},DocumentAction.prototype.call=function(ctx){var _this=this;null==ctx&&(ctx={});var self=this,event=null;$engLog.debug("engine.document.actions","action called",this);var consent=$q.when(!0);return this.isDelete()&&(console.log("delete called"),consent=$engine.confirm("Delete","Do you really want to perform this action?")),consent.then(function(){if(_this.$scope){var promises=[];if(event=_this.$scope.$broadcast("engine.common.action.before",{document:_this.document,action:_this,ctx:ctx,promises:promises}),_this.broadcastNotification("engine.notification.action.before"),event.defaultPrevented)return _this.$scope.$broadcast("engine.common.action.prevented",{document:_this.document,action:_this,ctx:ctx,event:event}),_this.broadcastNotification("engine.notification.action.prevented"),$q.reject();if(_this.isSave()&&(event=self.$scope.$broadcast("engine.common.save.before",{document:_this.document,action:_this,ctx:ctx,promises:promises}),_this.broadcastNotification("engine.notification.save.before"),event.defaultPrevented))return self.$scope.$broadcast("engine.common.save.prevented",{document:_this.document,action:_this,ctx:ctx,event:event}),self.broadcastNotification("engine.notification.save.prevented"),$q.reject()}return $q.all(promises).then(function(){return engActionResource.invoke(self.actionId,self.dontSendTemp===!0?null:self.document,self.document.id,self.parentDocumentId).$promise}).then(function(result){if($engLog.debug("engine.document.actions","action call returned",result),self.$scope){var ev1=self.$scope.$broadcast("engine.common.action.after",{document:self.document,action:self,ctx:ctx,result:result}),ev2=self.$scope.$broadcast("engine.common.save.after",{document:self.document,action:self,ctx:ctx,result:result});if(self.broadcastNotification("engine.notification.action.after"),self.isSave()&&self.broadcastNotification("engine.notification.save.after"),ev1.defaultPrevented||ev2.defaultPrevented)return result}return DocumentActionProcess(self.document,result,self.parentDocument,self.$scope)},function(result){return self.$scope.$broadcast("engine.common.action.error",{document:self.document,action:self,ctx:ctx,result:result}),self.broadcastNotification("engine.notification.action.error"),self.isSave()&&self.broadcastNotification("engine.notification.save.error"),$q.reject(result)})})},DocumentAction.prototype.isSave=function(){return _.contains(this.SAVE_ACTIONS,this.type)},DocumentAction.prototype.isCreate=function(){return this.type==this.TYPE_CREATE},DocumentAction.prototype.isLink=function(){return _.contains(this.LINK_ACTIONS,this.type)},DocumentAction.prototype.isDelete=function(){return _.contains(this.DELETE_ACTIONS,this.type)},DocumentAction}]).factory("DocumentActionProcess",["$location","$engine","engineDocument","$engLog","$q","DocumentModal","$rootScope",function($location,$engine,engineDocument,$engLog,$q,DocumentModal,$rootScope){return function(document,actionResponse,parentDocument,$scope){if("REDIRECT"===actionResponse.type){if(null===actionResponse.redirectToDocument)return $q.resolve();if(document.id===actionResponse.redirectToDocument&&null!=$scope)return $scope.$broadcast("engine.common.document.requestReload"),$q.resolve();var promise=null;return promise=null!=actionResponse.redirectContext?$q.when(actionResponse.redirectContext):null!=actionResponse.targetDocumentStates&&null!=actionResponse.targetDocumentStates[$engine.DOCUMENT_MODEL_KEY]?$q.when(actionResponse.targetDocumentStates[$engine.DOCUMENT_MODEL_KEY]):engineDocument.get(actionResponse.redirectToDocument).$promise.then(function(data){return data.document.states.documentType}),promise.then(function(documentModelTypeAndSteps){documentModelTypeAndSteps=documentModelTypeAndSteps.split("#");var documentModelType=documentModelTypeAndSteps[0],step=documentModelTypeAndSteps[1];null!=document.id&&document.id!==actionResponse.redirectToDocument&&($location.$$search.step=0),void 0!==step&&($location.$$search.step=step);var documentOptions=$engine.getOptions(documentModelType);if(null==documentOptions){var message="Document type to which redirection was requested has not been registrated! Make sure to register it in $engineProvider";throw $engLog.error(message,"DocumentType=",documentModelType),new Error(message)}return 1==documentOptions.dashboard?$location.path(documentModelType):0==documentOptions.subdocument?($location.$$path=$engine.pathToDocument(documentOptions,actionResponse.redirectToDocument),$location.$$compose()):DocumentModal(actionResponse.redirectToDocument,documentOptions,parentDocument.id,function(){return $rootScope.$broadcast("engine.list.reload")}),actionResponse})}}}]),angular.module("engine.document").factory("engAttachment",["$engineConfig","$http","Upload","$q","$engLog",function($engineConfig,$http,Upload,$q,$engLog){function EngineAttachment(document,metricId,isList){var documentId=document.id,self=this;this.isList=isList||!1,this.baseUrl=this.isList?listUrl:singleUrl,this.isList&&(self.dataDict={}),this.documentId=documentId,this.metricId=metricId,this.metricExists=!_.isEmpty(document.metrics[metricId]),this.action=null,this.data=null,this.label="Select file",this.ready=$q.all([this.loadActions(),$q.when(function(){if(null!=self.documentId&&self.metricExists)return self.loadMetadata()}())])}var listUrl="attachment-list",singleUrl="attachment";return EngineAttachment.prototype.clear=function(){this.data=null},EngineAttachment.prototype.getDownloadLink=function(file){return $engineConfig.baseUrl+this.baseUrl+"/download?documentId="+this.documentId+"&metricId="+this.metricId+"&fileId="+file},EngineAttachment.prototype.getFilename=function(file){return null==file?null!=this.data?this.data.fileName:null:(this.dataDict[file]||{}).fileName},EngineAttachment.prototype.getSize=function(file){return null==file?null!=this.data?this.data.length:null:(this.dataDict[file]||{}).length},EngineAttachment.prototype.loadMetadata=function(){var self=this;return self.data=null,$http.get($engineConfig.baseUrl+self.baseUrl+"?documentId="+this.documentId+"&metricId="+this.metricId).then(function(response){return self.data=response.data.data,self.isList&&(self.dataDict=_.indexBy(self.data,"id")),self.data},function(response){404==response.status&&(self.data=[])})},EngineAttachment.prototype.loadActions=function(){var self=this;return $http.post($engineConfig.baseUrl+"action/available/attachment?documentId="+this.documentId+"&metricId="+this.metricId).then(function(response){0==response.data.data.length&&$engLog.error("No Attachment action available for document: ",self.documentId," and metric ",self.metricId),self.action=response.data.data[0],self.label=self.action.label},function(response){});
},EngineAttachment.prototype.upload=function(file){var self=this,data=self.isList?{files:file}:{file:file};return Upload.upload({url:$engineConfig.baseUrl+"/action/invoke/"+self.baseUrl+"?documentId="+this.documentId+"&metricId="+this.metricId+"&actionId="+this.action.id,data:data})},EngineAttachment}]),angular.module("engine.document").filter("formatFileSize",function(){return function(input){return null==input?"- ":Math.floor(input/1024)+"kB"}}),angular.module("engine.document").controller("engAttachmentCtrl",["$scope","Upload","$engine","$timeout","engAttachment","$engLog","$translate",function($scope,Upload,$engine,$timeout,engAttachment,$engLog,$translate){function _init(){$scope.error=null,$scope.STATUS=STATUS,$scope.status=STATUS.loading,$scope.acceptedExtensions=$scope.metric.acceptedExtensions||"",null!=$scope.ctx.document.id?($scope.attachment=new engAttachment($scope.ctx.document,$scope.metric.id,$scope.isList),$scope.attachment.ready.then(function(){$scope.status=STATUS.normal})):($scope.status=STATUS.disabled,$scope.disable=!0)}var STATUS={loading:0,uploading:1,disabled:2,normal:3};null==$scope.model[$scope.metric.id]&&($scope.model[$scope.metric.id]=$scope.isList?[]:null),$scope.$watch("model."+$scope.metric.id,function(newValue,oldValue){null!=newValue&&newValue!=oldValue&&null!=$scope.ctx.document.id&&null!=$scope.attachment&&$scope.attachment.metricExists&&$scope.attachment.loadMetadata()}),$scope.$watch("invalidFile",function(newValue){newValue&&"pattern"===newValue.$error?$translate("ngfErrorPattern",{pattern:newValue.$errorParam}).then(function(translation){$scope.error=translation}):null===newValue&&($scope.error=null)}),$scope["delete"]=function(file){$engine.confirm("Delete file","Do you really want to delete this file?").then(function(){if($scope.status=STATUS.loading,$scope.isList){var indexOf=_.indexOf($scope.model[$scope.options.key],file);indexOf!==-1&&$scope.model[$scope.options.key].splice(indexOf,1)}else $scope.model[$scope.options.key]=null;$scope.attachment.clear();var event=$scope.$emit("engine.common.document.requestSave");event.savePromise.then(function(){$scope.error=null,$scope.status=STATUS.normal},function(){$scope.error="Could not save document",$scope.status=STATUS.normal})})},$scope.upload=function(file){if(null!=file){var event=$scope.$emit("engine.common.document.requestSave");event.savePromise.then(function(){$scope.progress=0,$scope.error=null,$scope.status=STATUS.uploading,$scope.uploadPromise=$scope.attachment.upload(file).then(function(response){$engLog.log("Success "+response.config.data[$scope.isList?"files":"file"].name+"uploaded. Response: "+response.data),$scope.status=STATUS.normal,$scope.error=null;var event=$scope.$emit("engine.common.document.requestReload");event.reloadPromise.then(function(){$scope.attachment.loadMetadata()})},function(response){$engLog.log("Error status: "+response.status),$scope.status=STATUS.normal,$scope.error="An error occurred during upload"},function(evt){$scope.progress=parseInt(100*evt.loaded/evt.total)})},function(){$scope.error="Could not save document",$scope.status=STATUS.normal})}},_init()}]),angular.module("engine.document").factory("createAttachmentCtrl",function(){return function(metric,ctx,isList){return function($scope,Upload,$timeout,engAttachment,$controller){$scope.isList=isList,$scope.metric=metric,$scope.ctx=ctx,$controller("engAttachmentCtrl",{$scope:$scope,Upload:Upload,$timeout:$timeout,engAttachment:engAttachment})}}}),angular.module("engine.document").factory("DocumentCategoryFactory",["DocumentCategory","$engLog","$parse",function(DocumentCategory,$engLog,$parse){function DocumentCategoryFactory(){this._categoryTypeList=[],this._defaultCategory=new DocumentCategory,this._registerBasicCategories()}return DocumentCategoryFactory.prototype.register=function(documentCategory){this._categoryTypeList.push(documentCategory)},DocumentCategoryFactory.prototype.makeCategory=function(category,ctx){for(var i=this._categoryTypeList.length-1;i>=0;--i)if(this._categoryTypeList[i].matches(category))return this._categoryTypeList[i].makeCategory(category,ctx);return this._defaultCategory.makeCategory(category,ctx)},DocumentCategoryFactory.prototype.makeStepCategory=function(step){var formStepStructure={fieldGroup:null,templateOptions:{disabled:!0},data:{step:step,hide:!0,$parse:$parse},wrapper:"step"};return formStepStructure.data.hasEntries=function(){return null!=formStepStructure.data.step.data.summary&&(null!=formStepStructure.data.step.data.summary.entries&&formStepStructure.data.step.data.summary.entries.length>0)},formStepStructure},DocumentCategoryFactory.prototype._registerBasicCategories=function(){this.register(new DocumentCategory("row",function(formlyCategory,metricCategory,ctx){return formlyCategory.templateOptions.wrapperClass="",formlyCategory.wrapper="row",formlyCategory.data.$process=function(){if(null==_.find(formlyCategory.fieldGroup,function(field){return null!=field.className&&null!=field.className.match(/(col-(md|xs|lg)-\d+)/g)})){var size=Math.floor(12/formlyCategory.fieldGroup.length);size=size<1?1:size,_.forEach(formlyCategory.fieldGroup,function(field){field.className+=" col-md-"+size})}},formlyCategory})),this.register(new DocumentCategory("category",function(formlyCategory,metricCategory,ctx){return formlyCategory.templateOptions.wrapperClass="text-box",formlyCategory.templateOptions.wrapperInnerClass="text-content",formlyCategory.wrapper="category",formlyCategory}))},new DocumentCategoryFactory}]).factory("DocumentCategory",["ConditionBuilder",function(ConditionBuilder){function DocumentCategory(categoryCondition,categoryBuilder){null==categoryBuilder&&(categoryBuilder=function(formlyCategory,metricCategory,ctx){return formlyCategory}),null==categoryCondition&&(categoryCondition=function(){return!0}),this.categoryCondition=ConditionBuilder(categoryCondition),this.categoryCustomizer=categoryBuilder,this.categoryWrapper="default",this.categoryWrapperCSS="",this.categoryWrapperInnerCSS=""}return DocumentCategory.prototype.matches=function(metricCategory){return this.categoryCondition(metricCategory)},DocumentCategory.hasMetrics=function(fieldGroup){return null!=_.find(fieldGroup,function(field){return!!field.data.isMetric||(null!=field.fieldGroup?DocumentCategory.hasMetrics(field.fieldGroup):void 0)})},DocumentCategory.prototype.makeCategory=function(metricCategory,ctx){var formlyCategory={templateOptions:{categoryId:metricCategory.id,wrapperClass:this.categoryWrapperCSS,label:metricCategory.label,visualClass:metricCategory.visualClass,css:null==metricCategory.visualClass?"":metricCategory.visualClass.join(" ")},fieldGroup:null,wrapper:this.categoryWrapper,data:{hasMetrics:function(){return DocumentCategory.hasMetrics(formlyCategory.fieldGroup)},position:metricCategory.position,metricCategory:metricCategory}};return this.categoryCustomizer(formlyCategory,metricCategory,ctx)},DocumentCategory}]),angular.module("engine.document").factory("ConditionBuilder",["$engineApiCheck",function($engineApiCheck){var _apiCheck=$engineApiCheck;return function(fieldCondition){_apiCheck([_apiCheck.oneOfType([_apiCheck.func,_apiCheck.string,_apiCheck.object])],arguments);var rFieldCondition=null;if(_.isFunction(fieldCondition))rFieldCondition=fieldCondition;else{var _condition;_condition=_.isString(fieldCondition)?{visualClass:fieldCondition}:fieldCondition,rFieldCondition=function(metric){for(var metricAttribute in _condition){if(_.isArray(metric[metricAttribute])&&!_.contains(metric[metricAttribute],_condition[metricAttribute]))return!1;if(_.isString(metric[metricAttribute])&&metric[metricAttribute]!=_condition[metricAttribute])return!1;if(null==metric[metricAttribute])return!1}return!0}}return rFieldCondition}}]),angular.module("engine.document").factory("DocumentFieldFactory",["DocumentField","$engine","$engLog","createAttachmentCtrl",function(DocumentField,$engine,$engLog,createAttachmentCtrl){function DocumentFieldFactory(){this._fieldTypeList=[],this._defaultField=new DocumentField,this._registerBasicCategories()}return DocumentFieldFactory.prototype._engineOptionsToFormly=function(engineOptions){var r=[];return _.forEach(engineOptions,function(option){r.push({name:null!=option.attributes&&null!=option.attributes.label?option.attributes.label:option.value,value:option.value,extraField:!0})}),r},DocumentFieldFactory.prototype.register=function(documentField){this._fieldTypeList.push(documentField)},DocumentFieldFactory.prototype.makeField=function(metricList,metric,ctx){for(var i=this._fieldTypeList.length-1;i>=0;--i)if(this._fieldTypeList[i].matches(metric))return this._fieldTypeList[i].makeField(metricList,metric,ctx);if(!this.allowDefaultField){var message="DocumentFieldFactory.allowDefaultField is false but there was a metric which could not be matched to registered types: ";throw $engLog.error(message,"Metric",metric,"Registered types",this._fieldTypeList),new Error(message)}return this._defaultField.makeField(metricList,metric,ctx)},DocumentFieldFactory.prototype.makeFields=function(metricList,ctx){var fields=[];return _.forEach(metricList,function(metric){fields.push(this.makeField(metricList,metric,ctx))},this),fields},DocumentFieldFactory.prototype._registerBasicCategories=function(metric){var self=this,optionsReloadHandler=function(newMetricData,field){$engLog.debug("reloading options in place",newMetricData,field),field.templateOptions.options=self._engineOptionsToFormly(_.filter(newMetricData.options,function(option){return _.contains(newMetricData.availableOptions,option.value)}))};this.register(new DocumentField({inputType:"TEXT"},function(field,metric,ctx){return field})),this.register(new DocumentField({inputType:"ATTACHMENT"},function(field,metric,ctx){return field.type="attachment",field.controller=createAttachmentCtrl(metric,ctx,!1),field})),this.register(new DocumentField({inputType:"ATTACHMENT_LIST"},function(field,metric,ctx){return field.type="attachmentList",field.controller=createAttachmentCtrl(metric,ctx,!0),field})),this.register(new DocumentField({visualClass:"select",inputType:"SELECT"},function(field,metric,ctx){return field.type="select",field.templateOptions.options=self._engineOptionsToFormly(metric.options),field.data.reloadInPlace=!0,field.data.reloadHandler=optionsReloadHandler,field})),this.register(new DocumentField({visualClass:"multiSelect",inputType:"MULTISELECT"},function(field,metric,ctx){return field.type="multiSelect",field.templateOptions.options=self._engineOptionsToFormly(metric.options),field.data.reloadInPlace=!0,field.data.reloadHandler=optionsReloadHandler,field.data.isDisabled=function(){return field.data.form.disabled||metric.nooverwrite},field})),this.register(new DocumentField({visualClass:"@verticalMultiSelect",inputType:"MULTISELECT"},function(field,metric,ctx){return field.type="multiSelectVertical",field.templateOptions.options=self._engineOptionsToFormly(metric.options),field.data.reloadInPlace=!0,field.data.reloadHandler=optionsReloadHandler,field.data.isDisabled=function(){return field.data.form.disabled||metric.nooverwrite},field})),this.register(new DocumentField({visualClass:"@imgMultiSelect",inputType:"MULTISELECT"},function(field,metric,ctx){field.type="multiSelectImage";var cols=metric.cols||2;field.templateOptions.cols=[],field.templateOptions.colClass="col-md-"+12/cols,field.templateOptions.optionsPerCol=Math.ceil(metric.options.length/cols);for(var i=0;i<cols;++i){var col=[];field.templateOptions.cols.push(col);for(var j=0;j<field.templateOptions.optionsPerCol&&i*field.templateOptions.optionsPerCol+j<metric.options.length;++j){var cm=metric.options[i*field.templateOptions.optionsPerCol+j];col.push({value:cm.value,css:null!=cm.visualClass?cm.visualClass.join(" "):"",label:cm.value})}}return null==field.model[field.key]&&(field.model[field.key]=[]),field.controller=function($scope){$scope.addRemoveModel=function(element){_.contains(field.model[field.key],element)?field.model[field.key].splice(field.model[field.key].indexOf(element),1):field.model[field.key].push(element),$scope.options.templateOptions.onChange(field.model[field.key],field,$scope)}},field.data.isDisabled=function(){return field.data.form.disabled||metric.nooverwrite},field.data.isActive=function(element){return _.contains(field.model[field.key],element)},field})),this.register(new DocumentField("radioGroup",function(field,metric,ctx){return field.type="radioGroup",field.templateOptions.options=self._engineOptionsToFormly(metric.options),field.data.reloadInPlace=!0,field.data.reloadHandler=optionsReloadHandler,field})),this.register(new DocumentField("radio",function(field,metric,ctx){return field.type="radio",field.templateOptions.options=self._engineOptionsToFormly(metric.options),field.data.reloadInPlace=!0,field.data.reloadHandler=optionsReloadHandler,field})),this.register(new DocumentField({visualClass:"date",inputType:"DATE"},function(field,metric,ctx){return field.type="datepicker",field.data.prepareValue=function(originalValue){return null==originalValue?originalValue:new Date(originalValue)},field.templateOptions.onBlur=void 0,field})),this.register(new DocumentField("checkbox",function(field,metric,ctx){return field.type="checkbox",field})),this.register(new DocumentField({inputType:"INTEGER"},function(field,metric,ctx){return field.type="input",field.templateOptions.type="text",field.templateOptions.numberConvert="true",field.data.prepareValue=function(value){var parsedValue=parseInt(value);return _.isNaN(parsedValue)?value:parsedValue},field})),this.register(new DocumentField({inputType:"FLOAT"},function(field,metric,ctx){return field.type="input",field.templateOptions.type="text",field.templateOptions.floatConvert="true",field.data.prepareValue=function(value){var parsedValue=parseFloat(value);return _.isNaN(parsedValue)?value:parsedValue},field})),this.register(new DocumentField({inputType:"NUMBER"},function(field,metric,ctx){return field.type="input",field.templateOptions.type="text",field.templateOptions.numberConvert="true",field.data.prepareValue=function(value){var parsedValue=parseInt(value);return _.isNaN(parsedValue)?value:parsedValue},field})),this.register(new DocumentField({inputType:"TEXTAREA"},function(field,metric,ctx){return field.type="textarea",field.templateOptions.rows=4,field.templateOptions.cols=15,field})),this.register(new DocumentField({inputType:"EXTERNAL"},function(field,metric,ctx){return field.data.onChange=DocumentField.onChange,field.data.onReload=DocumentField.onReload,{data:field.data,key:metric.id,template:"<"+metric.externalType+' ng-model="options.templateOptions.ngModel" options="options.templateOptions.options" metric="options.data.metric" errors="fc.$error" class="'+metric.visualClass.join(" ")+'" ng-disabled="options.data.form.disabled" formly-options="options" metric-id="'+metric.id+'"></'+metric.externalType+">",templateOptions:{ngModel:ctx.document,options:ctx.options}}})),this.register(new DocumentField({inputType:"QUERIED_LIST"},function(field,metric,ctx){return ctx.document.metrics[metric.id]=metric.queryId,field={data:_.extend(field.data,{queries:ctx.options.document.queries[metric.id],IMMEDIATE_CREATE:$engine.IMMEDIATE_CREATE}),key:metric.id,template:'<engine-document-list form-widget="true" parent-document="options.templateOptions.document" options="options.templateOptions.options" class="'+metric.visualClass.join(" ")+'"  list-caption="\''+metric.label+'\'" metric-id="'+metric.id+'" immediate-create="options.data.queries.immediateCreate || (options.data.queries.immediateCreate !== false && options.data.IMMEDIATE_CREATE === true)" single-document="options.data.queries.singleDocument || '+(null!=_.find(metric.visualClass,function(visualClass){return"@singleDocument"==visualClass}))+'" columns="options.data.queries.columns" formly-options="options"  query="\''+metric.queryId+'\'" show-create-button="'+metric.showCreateButton+'" on-select-behavior="'+metric.onSelectBehavior+'"></engine-document-list>',templateOptions:{options:$engine.getOptions(metric.modelId),document:ctx.document}}})),this.register(new DocumentField({inputType:"LINK"},function(field,metric,ctx){return{data:field.data,key:metric.id,template:'<engine-link><a class="'+metric.visualClass.join(" ")+'" href="'+metric.url+'" target="'+metric.target+'">"'+metric.label+'"</a></engine-link>',templateOptions:{ngModel:ctx.document,options:ctx.options}}}))},new DocumentFieldFactory}]).factory("DocumentField",["ConditionBuilder","$engLog","$q","$rootScope","$engine",function(ConditionBuilder,$engLog,$q,$rootScope,$engine){function DocumentField(fieldCondition,fieldBuilder){null==fieldBuilder&&(fieldBuilder=function(formlyField,metric,ctx){return formlyField}),null==fieldCondition&&(fieldCondition=function(){return!0}),this.fieldCondition=ConditionBuilder(fieldCondition),this.fieldCustomizer=fieldBuilder}return DocumentField.allFields={},DocumentField.onChange=function($viewValue,$modelValue,$scope){var promise=$q.when();return _.forEach($scope.options.data.onChangeHandlers,function(callback){promise=promise.then(function(){return callback($viewValue,$modelValue,$scope)})}),promise},DocumentField.validate=function($viewValue,$modelValue,$scope){},DocumentField.onReload=function($viewValue,$modelValue,$scope){return $scope.$emit("document.form.requestReload"),$scope.options.data.form._onReload()},DocumentField.onSave=function($viewValue,$modelValue,$scope){return $scope.$emit("engine.common.document.requestSave").savePromise.then(function(){return $rootScope.$broadcast("engine.list.reload",$scope.query)})},DocumentField.onValidateSelf=function($viewValue,$modelValue,$scope){var metricToValidate={};metricToValidate[$scope.options.data.metric.id]=null==$viewValue?null:$viewValue,$scope.options.data.form.validator.validateMetrics($modelValue,metricToValidate)},DocumentField.onValidate=function($viewValue,$modelValue,$scope){return $scope.$emit("document.form.requestValidate"),$scope.options.data.form.validateCurrentStep(!1)},DocumentField.prototype.matches=function(metric){return this.fieldCondition(metric)},DocumentField.prototype.makeField=function(metricList,metric,ctx){var formlyField={key:metric.id,model:ctx.document.metrics,type:"input",className:metric.visualClass.join(" "),data:{metric:metric,position:metric.position,isMetric:!0,form:ctx.documentForm,categoryId:metric.categoryId,unit:metric.unit,id:metric.id,onChangeHandlers:[],reloadInPlace:!1,reloadHandler:function(newMetric,field){}},templateOptions:{type:"text",label:metric.label,metricId:metric.id,description:metric.description,placeholder:"Enter missing value",visualClass:metric.visualClass,onChange:DocumentField.onChange},ngModelAttrs:{metricId:{attribute:"metric-id"}},expressionProperties:{"templateOptions.disabled":function($viewValue,$modelValue,scope){return metric.nooverwrite||scope.options.data.form.disabled}},validation:{messages:{server:function(viewValue,modelValue,scope){return _.isArray(scope.to.serverErrors)&&scope.to.serverErrors.length>0?scope.to.serverErrors[0]:""}}}};null!=metric.unit&&(formlyField.wrapper="unit"),formlyField.data.onChangeHandlers.push(function(value,model,scope){return $engine.ON_METRIC_CHANGE(model.data.metric.id,scope.originalModel,DocumentField.allFields)}),metric.saveOnChange===!0&&formlyField.data.onChangeHandlers.push(DocumentField.onSave),metric.reloadOnChange===!0&&formlyField.data.onChangeHandlers.push(DocumentField.onReload),metric.validateOnChange===!0?["TEXT","TEXTAREA","NUMBER","FLOAT","INTEGER"].indexOf(metric.inputType)!==-1?formlyField.templateOptions.onBlur=DocumentField.onValidate:formlyField.data.onChangeHandlers.push(DocumentField.onValidate):["TEXT","TEXTAREA","NUMBER","FLOAT","INTEGER"].indexOf(metric.inputType)!==-1?formlyField.templateOptions.onBlur=DocumentField.onValidateSelf:formlyField.data.onChangeHandlers.push(DocumentField.onValidateSelf);var ret=this.fieldCustomizer(formlyField,metric,ctx);return _.isFunction(ret.data.prepareValue)&&(ctx.document.metrics[metric.id]=ret.data.prepareValue(ctx.document.metrics[metric.id])),DocumentField.allFields[metric.id]=ret,ret},DocumentField}]).directive("numberConvert",function(){var JAVA_MAX_INT=2147483647,JAVA_MIN_INT=-2147483648;return{restrict:"A",require:"ngModel",scope:{model:"=ngModel"},link:function(scope,element,attrs,ngModelCtrl){if(scope.model&&"string"==typeof scope.model)if(scope.model.match(/^\d+$/)){var pv=Number(scope.model);_.isNaN(pv)||(scope.model=pv)}else scope.model=val;scope.$watch("model",function(val,old){if("string"==typeof val)if(val.match(/^-?\d+$/)){var pv=Number(val);!_.isNaN(pv)&&pv<JAVA_MAX_INT&&pv>JAVA_MIN_INT?scope.model=pv:scope.model=val}else scope.model=old})}}}).directive("floatConvert",function(){return{restrict:"A",require:"ngModel",scope:{model:"=ngModel"},link:function(scope,element,attrs,ngModelCtrl){if(scope.model&&"string"==typeof scope.model)if(scope.model.match(/^\d+(\.\d+)?$/)){var pv=Number(scope.model);_.isNaN(pv)||(scope.model=pv)}else scope.model=val;scope.$watch("model",function(val,old){if("string"==typeof val)if(val.match(/^\d+(\.\d+)?$/)){var pv=Number(val);_.isNaN(pv)?scope.model=val:scope.model=pv}else scope.model=val})}}}).directive("numberFormat",["$translate",function($translate){var JAVA_MAX_INT=2147483647,JAVA_MIN_INT=-2147483648;return{require:"ngModel",link:function(scope,element,attrs,ngModelCtrl){ngModelCtrl.$formatters.push(function(value){var number=Number(value);return _.isNaN(number)||!scope.options.data.form.disabled&&!scope.options.data.metric.nooverwrite?value:number.toLocaleString($translate.use())}),ngModelCtrl.$parsers.splice(0,0,function(val){if("string"==typeof val)switch(scope.options.data.metric.inputType){case"INTEGER":if(""!==val&&!val.match(/^-?\d*$/)){var nv=(ngModelCtrl.$modelValue||"").toString();return ngModelCtrl.$setViewValue(nv),ngModelCtrl.$render(),nv}var pv=Number(val);if(!_.isNaN(pv)){if(pv>JAVA_MIN_INT&&pv<JAVA_MAX_INT)return pv;var correctedVal=pv<0?JAVA_MIN_INT:JAVA_MAX_INT;return ngModelCtrl.$setViewValue(correctedVal.toString()),ngModelCtrl.$render(),correctedVal}break;case"NUMBER":case"FLOAT":var _pv=Number(val);return _.isNaN(_pv)?val:_pv;default:return val}return val})}}}]),angular.module("engine.document").factory("DocumentForm",["engineMetricCategories","engineMetric","DocumentFieldFactory","$q","DocumentCategoryFactory","$engineApiCheck","$engLog","DocumentValidator",function(engineMetricCategories,engineMetric,DocumentFieldFactory,$q,DocumentCategoryFactory,$engineApiCheck,$engLog,DocumentValidator){function DocumentForm(documentScope){assert(null!=documentScope),this.documentScope=documentScope,this.fieldList=[],this.metricList=[],this.metricDict={},this.metricCategories={},this.document=null,this.parentDocumentId=documentScope.$ctrl.parentDocument?documentScope.$ctrl.parentDocument.id||documentScope.$ctrl.parentDocument:void 0,this.documentOptions=null,this.steps=null,this.disabled=!1,this.categoryWrapper="category",this.categoryWrapperCSS="text-box",this.formStructure=[],this.currentFormlyFields=[],this.formlyFields=[],this.validator=null,this.currentStep=null,this.categoriesDict={},this.formLoaded=!1,this.markInit=null;var self=this;this.$validationReadyDeferred=$q.defer(),this.$validationReady=this.$validationReadyDeferred.promise,this.$ready=$q(function(resolve,reject){self.markInit=resolve}).then(function(){return self._loadMetricCategories()}),this.bindings=[],this.bindings.push(this.documentScope.$on("engine.common.save.after",function(event){self.formlyState.$setPristine()})),this.bindings.push(this.documentScope.$on("engine.common.navigateAway",function(event){self.formlyState.$dirty&&event.preventDefault()}))}var _apiCheck=$engineApiCheck;return DocumentForm.prototype.$destroy=function(){_.each(this.bindings,function(binding){binding()})},DocumentForm.prototype.loadForm=function(){var self=this;return this.$ready.then(function(){return self._loadMetrics()}).then(function(){self._makeForm(),self.formLoaded=!0})},DocumentForm.prototype._reloadForm=function(){var self=this;if(!this.formLoaded)throw $engLog.error("DocumentForm._reloadForm called without waiting for DocumentForm.loadForm"),new Error;this.documentScope.$broadcast("document.form.reloadingMetrics.before");var options={documentJSON:this.document};return self.parentDocumentId&&(options.otherDocumentId=self.parentDocumentId),engineMetric(options,function(metricList){$engLog.log("New loaded metrics: ",metricList);var metricDict=_.indexBy(metricList,"id"),newMetrics=_.reject(metricList,function(metric){return metric.id in self.metricDict});$engLog.log("New metrics: ",newMetrics),_.forEach(self.metricList,function(metric){if(!(metric.id in metricDict)){var metricIndex=_.findIndex(self.categoriesDict[metric.categoryId].fieldGroup,function(field){return field.data.id===metric.id});if(metricIndex===-1)return;self.fieldList.splice(self.fieldList.findIndex(function(field){return field.key===metric.id}),1),$engLog.log("Metric to remove: ",metric,"index: ",metricIndex),delete self.steps.getCurrentStep().fields[metric.id],delete self.metricDict[metric.id],self.categoriesDict[metric.categoryId].fieldGroup.splice(metricIndex,1),delete self.document.metrics[metric.id]}}),self.setDefaultMetricValues(newMetrics),_.forEach(newMetrics,function(newMetric){$engLog.log(self.categoriesDict[newMetric.categoryId]),self.addMetric(newMetric);var field=DocumentFieldFactory.makeField(self.metricList,newMetric,{document:self.document,options:self.documentOptions,documentForm:self});self.categoriesDict[newMetric.categoryId].fieldGroup.splice(newMetric.position,0,field),self.categoriesDict[newMetric.categoryId].fieldGroup=_.sortBy(self.categoriesDict[newMetric.categoryId].fieldGroup,function(metric){return metric.data.position});for(var i=0;i<self.steps.getSteps().length;++i){var step=self.steps.getStep(i);if(void 0!==self.categoriesDict[field.data.categoryId]){if(void 0!==step.metrics[field.data.categoryId]){step.fields[field.data.id]=field;break}}else $engLog.warn("$engine.document.DocumentForm There is a metric belonging to metric category which is not connected to any step!","field",field,"categoryId",field.data.categoryId)}}),_.forEach(_.filter(self.fieldList,function(metric){return metric.data.reloadInPlace===!0}),function(metric){var newMetricData=_.find(metricList,function(metricData){return metricData.id===metric.key});return null==newMetricData?void $engLog.error("newMetricData with id "+metric.key+" has not been found in ",metricList):void metric.data.reloadHandler(newMetricData,metric)}),self.documentScope.$broadcast("document.form.reloadingMetrics.after")}).$promise},DocumentForm.prototype.connectFieldToStep=function(){function reconnectFieldsToStep(step,metricCategories){_.forEach(metricCategories,function(metricCategory){metricCategory.children&&reconnectFieldsToStep(step,metricCategory.children);var category=self.categoriesDict[metricCategory.id];null!=category&&(_.isFunction(category.data.$process)&&_categoriesToPostProcess.push(category),step.metrics[metricCategory.id]=category)})}var self=this,_categoriesToPostProcess=[];self.setFormlyState(self.formlyState),_.forEach(self.steps.getSteps(),function(step){reconnectFieldsToStep(step,step.metricCategories)}),_.forEach(self.steps.getSteps(),function(step){_.forEach(self.fieldList,function(field){return void 0===self.categoriesDict[field.data.categoryId]?void $engLog.warn("$engine.document.DocumentForm There is a metric belonging to metric category which is not connected to any step!","field",field,"categoryId",field.data.categoryId):void(void 0!==step.metrics[field.data.categoryId]&&(_.contains(self.fields,field)&&(self.fields=_.without(self.fields,field)),step.fields[field.data.id]=field))})}),_.forEach(_categoriesToPostProcess,function(entry){return entry.data.$process()})},DocumentForm.prototype.addMetric=function(metric){metric.id in this.metricDict||(this.metricList.push(metric),this.metricDict[metric.id]=metric)},DocumentForm.prototype._loadMetricCategories=function(){var self=this;return engineMetricCategories.then(function(metricCategories){self.metricCategories=metricCategories})},DocumentForm.prototype._setDocument=function(document){null!=this.document?(this.document=document,_.forEach(this.fieldList,function(field){field.model=document.metrics,field.data.prepareValue&&(document.metrics[field.key]=field.data.prepareValue(document.metrics[field.key]))})):this.document=document},DocumentForm.prototype._setActions=function(actions){this.actions=actions},DocumentForm.prototype._setOptions=function(documentOptions){this.documentOptions=documentOptions},DocumentForm.prototype._setSteps=function(steps){this.steps=steps,_.forEach(this.steps.getSteps(),function(step){_.forEach(step.metricCategories,function(metricCategory){_.isArray(metricCategory.visualClass)?metricCategory.visualClass.push("category"):metricCategory.visualClass=["category"]})})},DocumentForm.prototype.init=function(document,options,steps,actions,formlyState,formlyOptions){_apiCheck([_apiCheck.object,_apiCheck.object,_apiCheck.arrayOf(_apiCheck.object),_apiCheck.object,_apiCheck.object],arguments),this._setDocument(document),this._setOptions(options),this._setSteps(steps),this._setActions(actions),this.setFormlyState(formlyState),this.formlyOptions=formlyOptions,this.markInit()},DocumentForm.prototype.setValidator=function(validator){this.validator=validator,this.$validationReadyDeferred.resolve()},DocumentForm.prototype.setFormlyState=function(formlyState){this.formlyState=formlyState,null!=this.formlyState&&this.setValidator(new DocumentValidator(this.document,this.parentDocumentId,this.steps,this.formlyState))},DocumentForm.prototype.setFormlyOptions=function(formlyOptions){this.formlyOptions=formlyOptions},DocumentForm.prototype.setEditable=function(editable){this.disabled=!editable},DocumentForm.prototype.isEditable=function(){return!this.disabled},DocumentForm.prototype.setStep=function(step){this.currentFormlyFields=this.formStructure[step],null!=this.currentStep&&(this.formStructure[this.currentStep].data.hide=!0),this.currentStep=step,this.formStructure[this.currentStep].data.hide=!1,$engLog.debug("current fields to display in form",this.currentFormlyFields)},DocumentForm.prototype._assertInit=function(){var message=" is null! make sure to call DocumentForm.init(document, options, steps) before calling other methods";assert(null!=this.document,"DocumentForm.document"+message),assert(null!=this.documentOptions,"DocumentForm.documentOptions"+message),assert(null!=this.steps,"DocumentForm.steps"+message),assert(null!=this.actions,"DocumentForm.actions"+message)},DocumentForm.prototype._onReload=function(){return $engLog.debug("Form reload called"),this._reloadForm()},DocumentForm.prototype._makeForm=function(){function parseMetricCategories(step,metricCategories){var formCategories=[];return _.forEach(metricCategories,function(metricCategory){var formMetricCategory=DocumentCategoryFactory.makeCategory(metricCategory,{document:self.document});formMetricCategory.fieldGroup=parseMetricCategories(step,metricCategory.children),self.categoriesDict[metricCategory.id]=formMetricCategory,step.metrics[metricCategory.id]=formMetricCategory,_.isFunction(formMetricCategory.data.$process)&&_categoriesToPostProcess.push(formMetricCategory),formCategories.push(formMetricCategory)}),formCategories}function connectFields(step){_.forEach(self.fieldList,function(field){return void 0===self.categoriesDict[field.data.categoryId]?void $engLog.warn("$engine.document.DocumentForm There is a metric belonging to metric category which is not connected to any step!","field",field,"categoryId",field.data.categoryId):void(void 0!==step.metrics[field.data.categoryId]&&(self.categoriesDict[field.data.categoryId].fieldGroup.push(field),step.fields[field.data.id]=field))})}function postprocess(){_.forEach(_categoriesToPostProcess,function(entry){entry.data.$process()})}function reorderFields(){_.forEach(self.categoriesDict,function(metricCategory){
metricCategory.fieldGroup=_.sortBy(metricCategory.fieldGroup,function(field){return field.data.position})})}var self=this;$engLog.log("DocumentForm._makeForm",self.fieldList),self._assertInit(),assert(1==self.metricList.$resolved,"Called DocumentForm._makeForm() before calling DocumentForm._loadMetrics"),assert(1==self.metricCategories.$resolved,"Called DocumentForm._makeForm() before calling DocumentForm._loadMetricCategories");var _categoriesToPostProcess=[];return _.forEach(self.steps.getSteps(),function(step){var formStepStructure=DocumentCategoryFactory.makeStepCategory(step);formStepStructure.fieldGroup=parseMetricCategories(step,step.metricCategories),self.formStructure.push(formStepStructure)}),_.forEach(self.steps.getSteps(),function(step){connectFields(step)}),postprocess(),reorderFields(),null!=self.formlyState&&self.setValidator(new DocumentValidator(self.document,self.parentDocumentId,self.steps,self.formlyState)),$engLog.debug("DocumentForm form structure",self.formStructure),self.formStructure},DocumentForm.prototype.setDefaultMetricValues=function(metrics){var self=this;metrics.forEach(function(metric){metric.defaultValue&&!self.document.metrics[metric.id]&&(self.document.metrics[metric.id]=metric.defaultValue)})},DocumentForm.prototype._updateFields=function(metricList){this.fieldList=DocumentFieldFactory.makeFields(metricList,{document:this.document,options:this.documentOptions,documentForm:this})},DocumentForm.prototype._loadMetrics=function(){var self=this,options={documentJSON:this.document};return self.parentDocumentId&&(options.otherDocumentId=self.parentDocumentId),engineMetric(options,function(metricList){self.metricList=metricList,self.metricDict=_.indexBy(self.metricList,"id"),self.setDefaultMetricValues(self.metricList),self._updateFields(self.metricList)}).$promise},DocumentForm.prototype.prepareMetrics=function(){$engLog.debug(this)},DocumentForm.prototype.validateCurrentStep=function(fillNull){var self=this;return this.$validationReady.then(function(){return self.validator.validate(self.currentStep,fillNull)})},DocumentForm.prototype.validate=function(step,fillNull){var self=this;return this.$validationReady.then(function(){return self.validator.validate(step,fillNull)})},DocumentForm}]),angular.module("engine.document").factory("StepList",["Step","$q","engineMetricCategories","$engineApiCheck","$engLog","$parse",function(Step,$q,engineMetricCategories,$engineApiCheck,$engLog,$parse){function StepList(documentOptionSteps){this.documentSteps=documentOptionSteps,this.steps=[],this.singleStep=!1,this._$readyDeferred=$q.defer(),this.$ready=this._$readyDeferred.promise,this.currentStep=null}return StepList.prototype.setDocument=function(document){var self=this;this.document=document,this.steps!=[]&&(this.steps=[]),this.documentSteps=_.filter(this.documentSteps,function(step){var cond=step.condition;return null==cond||(_.isString(cond)?$parse(cond)(self.document):!!_.isFunction(cond)&&cond(self.document))}),this._preprocessDocumentSteps()},StepList.prototype._preprocessDocumentSteps=function(){var self=this;engineMetricCategories.then(function(metricCategories){assert(_.isArray(self.documentSteps)&&!_.isEmpty(self.documentSteps),"documentSteps were not defined"),_.forEach(self.documentSteps,function(step,index){if(_.isArray(step.categories)){var _categories=[];_.forEach(step.categories,function(categoryId){_categories.push(metricCategories.getNames(categoryId))}),self.steps.push(new Step(_categories,step,index))}else{if(!(step.categories in metricCategories.metrics))throw $engLog.error(step.categories," not in ",metricCategories.metrics,". Make sure that metric category registered in document.steps exists"),new Error;self.steps.push(new Step(metricCategories.metrics[step.categories].children,step,index))}}),self._$readyDeferred.resolve()},function(error){self._$readyDeferred.reject(error)})},StepList.prototype.isLast=function(step){return step==this.steps.length-1},StepList.prototype.getFirstInvalid=function(){return _.find(this.steps,function(step){return step.state==Step.STATE_INVALID})},StepList.prototype.getFirstInvalidIndex=function(){return this.getFirstInvalid().index},StepList.prototype.getSteps=function(){return this.steps},StepList.prototype.getStep=function(stepIndex){return this.steps[stepIndex]},StepList.prototype.setCurrentStep=function(stepIndex){this.currentStep=this.steps[stepIndex]},StepList.prototype.getCurrentStep=function(){return this.currentStep},StepList.prototype.getCurrentStepIndex=function(){return this.steps.indexOf(this.currentStep)},StepList}]).factory("Step",["$engineApiCheck",function($engineApiCheck){function Step(metricCategories,data,index,visible){this.metricCategories=metricCategories,this.metrics={},this.fields={},this.visible=null!=visible,this.state=Step.defaultState,this.$valid=!1,this.name=data.name,this.index=index,this.data=data}return Step.STATE_VALID="valid",Step.STATE_INVALID="invalid",Step.STATE_BLANK="blank",Step.STATE_LOADING="loading",Step.validStates=[Step.STATE_VALID,Step.STATE_INVALID,Step.STATE_LOADING,Step.STATE_BLANK],Step.defaultState="blank",Step.prototype.setState=function(state){assert(null!=state,"Privided state (",state,") is not in",Step.validStates),$engineApiCheck([$engineApiCheck.oneOf(Step.validStates)],arguments),this.state=state},Step.prototype.getState=function(){return this.state},Step}]),angular.module("engine.document").factory("DocumentValidator",["engineDocument","$engineApiCheck","$engLog","Step",function(engineDocument,$engineApiCheck,$engLog,Step){function DocumentValidator(document,parentDocumentId,stepList,formStructure){this.document=document,this.parentDocumentId=parentDocumentId,this.stepList=stepList,this.formStructure=formStructure}return DocumentValidator.prototype.setStepsState=function(steps,state){$engineApiCheck([$engineApiCheck.arrayOf($engineApiCheck.instanceOf(Step)),$engineApiCheck.oneOf(Step.validStates)],arguments),_.forEach(steps,function(step){step.setState(state)})},DocumentValidator.prototype.cleanDocumentMetrics=function(){var documentForValidation=_.omit(this.document,["metrics","$ext"]);return documentForValidation.metrics={},documentForValidation},DocumentValidator.prototype.makeDocumentForValidation=function(document,stepsToValidate,fillNull){var documentForValidation=this.cleanDocumentMetrics();return _.forEach(stepsToValidate,function(step){_.forEach(step.fields,function(field){documentForValidation.metrics[field.data.id]=document.metrics[field.data.id],fillNull&&void 0===documentForValidation.metrics[field.data.id]&&(documentForValidation.metrics[field.data.id]=null)})}),documentForValidation},DocumentValidator.prototype.validateMetrics=function(field,metrics){var self=this;$engineApiCheck["throw"]([$engineApiCheck.object],arguments);var documentForValidation=this.cleanDocumentMetrics();return documentForValidation.metrics=metrics,engineDocument.validate({document:documentForValidation,otherDocumentId:self.parentDocumentId}).$promise.then(function(validatedMetrics){return validatedMetrics=_.indexBy(validatedMetrics.results,"metricId"),self.setMetricValidation(field,validatedMetrics),validatedMetrics})},DocumentValidator.prototype.setMetricValidation=function(field,validatedMetrics){var self=this;null!=self.formStructure[field.id]&&(null!=validatedMetrics[field.key]&&self.formStructure[field.id].$setValidity("server",validatedMetrics[field.key].valid),field.validation.show=!validatedMetrics[field.key].valid),field.templateOptions.serverErrors=null==validatedMetrics[field.key]?[]:validatedMetrics[field.key].messages},DocumentValidator.prototype.validate=function(step,fillNull){$engineApiCheck([$engineApiCheck.typeOrArrayOf($engineApiCheck.number).optional],arguments);var self=this;$engLog.debug("DocumentValidator.validate called");var stepsToValidate=[];null==step?stepsToValidate=this.stepList.getSteps():(_.isArray(step)||(step=[step]),_.forEach(step,function(stepIndex){stepsToValidate.push(self.stepList.getStep(stepIndex))})),this.setStepsState(stepsToValidate,Step.STATE_LOADING);var documentForValidation=this.makeDocumentForValidation(this.document,stepsToValidate,fillNull);return engineDocument.validate({document:documentForValidation,otherDocumentId:self.parentDocumentId}).$promise.then(function(validationData){$engLog.debug(validationData);var _validatedMetrics=_.indexBy(validationData.results,"metricId");return _.forEach(stepsToValidate,function(step){_.forEach(step.fields,function(field,fieldId){fieldId in _validatedMetrics&&(0==_validatedMetrics[fieldId].valid&&step.setState(Step.STATE_INVALID),self.setMetricValidation(field,_validatedMetrics))}),$engLog.debug(self.formStructure.$error),step.getState()==Step.STATE_LOADING&&step.setState(Step.STATE_VALID)}),validationData.valid})},DocumentValidator}]),angular.module("engine.steps").component("engineSteps",{templateUrl:"/src/document/steps.tpl.html",controller:["$timeout",function($timeout){var self=this;this.changeStep=function(newStep){this.processing!==!0&&(self.step=newStep)}}],bindings:{ngModel:"=",step:"=",stepList:"=",options:"=",processing:"<"}}),angular.module("engine").controller("engineMainCtrl",["$rootScope","engineResourceLoader",function($rootScope,engineResourceLoader){$rootScope.resourcesLoaded=!1,0==engineResourceLoader.resources?$rootScope.resourcesLoaded=!0:$rootScope.$on("engine.common.resourcesLoaded",function(){$rootScope.resourcesLoaded=!0})}]);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),app=angular.module("engine");app.factory("engActionButton",["$timeout","DocumentActionList","$rootScope",function($timeout,DocumentActionList,$rootScope){var ActionButton=function(){function ActionButton(actionId,requestJson){var label=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;_classCallCheck(this,ActionButton),this.actionId=actionId,this.requestJson=requestJson,this.callback=null,this.label=label,this._$scope=$rootScope.$new(!0),this._actionList=null,this.refresh()}return _createClass(ActionButton,[{key:"refresh",value:function(){var _this=this;this.callback=null,this._actionList=new DocumentActionList(null,this.requestJson,null,this._$scope),this._actionList.$ready.then(function(){var action=_.find(_this._actionList.actions,function(action){return action.actionId===_this.actionId});action&&(_this.callback=function(){return action.call()},_this.label=_this.label||action.label)})}}]),ActionButton}();return ActionButton}]),angular.module("engine").provider("$engLog",function(){function canLog(level){return _logLevels.indexOf(level)>=_logLevels.indexOf(_logLevel)}var _logLevel="debug",_provider=this;this.setLogLevel=function(level){_logLevel=level};var _logLevels=["debug","log","info","warning","error",null];this.$get=["$log",function($log){return new function(){this.setLogLevel=_provider.setLogLevel,this.debug=function(){canLog("debug")&&$log.debug(arguments)},this.info=function(){canLog("info")&&$log.info(arguments)},this.log=function(){canLog("log")&&$log.log(arguments)},this.warn=function(){canLog("warning")&&$log.warn(arguments)},this.error=function(){throw canLog("error")&&$log.error(arguments),new Error(arguments)},this.warning=this.warn}}]}).provider("$engineConfig",function(){var self=this,_baseUrl="",_loggingLevel="debug";this.setBaseUrl=function(url){_baseUrl=url},this.setLoggingLevel=function(level){_loggingLevel=level},this.$get=function(){return{baseUrl:_baseUrl,setBaseUrl:self.setBaseUrl}}}).provider("$engineApiCheck",["productionMode",function(productionMode){var self=this;this.apiCheck=apiCheck({output:{prefix:"angular-engine"},disabled:!0}),this.$get=function(){return self.apiCheck}}]).service("engineResourceLoader",["$rootScope","$engLog",function($rootScope,$engLog){var _resourcesCount=0;return{register:function(promise){$engLog.debug("registered resource",promise),++_resourcesCount,promise.then(function(){--_resourcesCount,0==_resourcesCount&&$rootScope.$broadcast("engine.common.resourcesLoaded")})},resources:_resourcesCount}}]).provider("$engine",["$routeProvider","$engineApiCheckProvider","$engineFormlyProvider","$injector",function($routeProvider,$engineApiCheckProvider,$engineFormlyProvider,$injector){function prepareDocumentOptions(options){null==options.list.customButtons&&(options.list.customButtons=[]),_.isArray(options.list.customButtons)||(options.list.customButtons=[options.list.customButtons]),null==options.document.sidebarAddons&&(options.document.sidebarAddons=[]),options.document.sidebarAddons=options.document.sidebarAddons.map(function(addon){return{position:addon.position||"middle",caption:addon.caption||"",condition:addon.condition||function(document){return!0},component:addon.component,ctx:addon.ctx||{}}})}function _checkDocumentOptions(options){null!=options.document&&(null!=options.document.queries&&_.each(options.document.queries,function(metric){_apiCheck["throw"]([_apiCheck.shape({columns:_apiCheck.columnOptions,singleDocument:_apiCheck.bool.optional})],[metric])}),null==options.document.queries&&(options.document.queries={}))}var _this=this,self=this,ERROR_HANDLER=function(currentRoute,error){},dashboards=[],dashboards_d={},documents=[],documents_d={},QUERY_PAGE_SIZE=50,GLOBAL_CSS="",ON_METRIC_CHANGE=function(metricId,document,metrics){},MODAL_CONTAINER="body",RESPONSIVE=!0,DOCUMENT_MODEL_KEY="documentType",IMMEDIATE_CREATE=!1,_apiCheck=$engineApiCheckProvider.apiCheck;_apiCheck.columnOptions=_apiCheck.arrayOf(_apiCheck.shape({name:_apiCheck.string,caption:_apiCheck.string.optional,style:_apiCheck.string.optional,type:_apiCheck.string.optional})).optional,_apiCheck.documentOptions=_apiCheck.shape({documentJSON:_apiCheck.object,immediateCreate:_apiCheck.bool.optional,name:_apiCheck.string,list:_apiCheck.shape({caption:_apiCheck.string,templateUrl:_apiCheck.string,createButtonLabel:_apiCheck.string.optional,customButtons:_apiCheck.typeOrArrayOf(_apiCheck.shape({label:_apiCheck.string,callback:_apiCheck.oneOfType([_apiCheck.func,_apiCheck.string])})).optional}),document:_apiCheck.shape({templateUrl:_apiCheck.string,steps:_apiCheck.arrayOf(_apiCheck.object),showValidateButton:_apiCheck.bool.optional,caption:_apiCheck.string.optional,queries:_apiCheck.object.optional,sidebarAddons:_apiCheck.arrayOf(_apiCheck.shape({component:_apiCheck.string,position:_apiCheck.object.optional,ctx:_apiCheck.string.optional})).optional})});var _defaultDocumentOptions={list:{templateUrl:"/src/list/list.wrapper.tpl.html"},document:{templateUrl:"/src/document/document.wrapper.tpl.html",showValidationButton:!0}};this.confirmModal="engConfirm",this.registerConfirmModal=function(confirmModalMethod){_this.confirmModal=confirmModalMethod},this.setOnMetricChange=function(handler){ON_METRIC_CHANGE=handler},self._disableOnReload=!1,this.disableOnReload=function(){self._disableOnReload=!0},this.enableOnReload=function(){self._disableOnReload=!1},this.setQueryPageSize=function(queryPageSize){QUERY_PAGE_SIZE=queryPageSize},this.setGlobalCSS=function(css){GLOBAL_CSS=css},this.setModalContainer=function(containerSelector){MODAL_CONTAINER=containerSelector},this.setResponsive=function(responsive){RESPONSIVE=responsive},this.setDocumentModelKey=function(key){DOCUMENT_MODEL_KEY=key},this.setImmediateCreate=function(immediate){IMMEDIATE_CREATE=immediate},this.setErrorHandler=function(callback){ERROR_HANDLER=callback},this.dashboard=function(url,queries,options){var _options={templateUrl:"/src/dashboard/dashboard.tpl.html"};options=angular.merge(_options,options),_apiCheck([_apiCheck.oneOfType([_apiCheck.string,_apiCheck.object]),_apiCheck.arrayOf(_apiCheck.shape({queryId:_apiCheck.string,label:_apiCheck.string,controller:_apiCheck.string,contentTemplateUrl:_apiCheck.string.optional,documentModelId:_apiCheck.string.optional,columns:_apiCheck.columnOptions,showCreateButton:_apiCheck.bool.optional,immediateCreate:_apiCheck.bool.optional,customButtons:_apiCheck.typeOrArrayOf(_apiCheck.shape({label:_apiCheck.string,callback:_apiCheck.oneOfType([_apiCheck.func,_apiCheck.string])})).optional}),_apiCheck.shape({templateUrl:_apiCheck.string,caption:_apiCheck.string.optional}))],[url,queries,options]),options.queries=queries;var dashboardRoutingOptions={};_.isObject(url)&&(dashboardRoutingOptions=url,url=url.url),dashboardRoutingOptions.templateUrl=options.templateUrl,dashboardRoutingOptions.controller="engineDashboardCtrl",dashboardRoutingOptions.options=options,$routeProvider.when(url,dashboardRoutingOptions),dashboards_d[url]={dashboard:!0},dashboards.push({url:url,queries:queries,options:options})},this.document=function(documentModelType,listUrl,documentUrl,query,options){options=angular.merge(angular.copy(_defaultDocumentOptions),options),_apiCheck["throw"]([_apiCheck.string,_apiCheck.oneOfType([_apiCheck.string,_apiCheck.object]),_apiCheck.oneOfType([_apiCheck.string,_apiCheck.object]),_apiCheck.typeOrArrayOf(_apiCheck.string),_apiCheck.documentOptions],[documentModelType,listUrl,documentUrl,query,options]),assert(options.document.steps.length>0,"options.document.steps has length == 0, please define at least one step for document"),prepareDocumentOptions(options),_checkDocumentOptions(options),options.documentModelType=documentModelType,options.listUrl=listUrl.url||listUrl,options.list.url=options.listUrl,options.documentUrl=documentUrl.url||documentUrl,options.document.url=options.documentUrl,options.query=query,options.subdocument=!1;var documentRoutingOptions={};_.isObject(documentUrl)&&(documentRoutingOptions=documentUrl),documentRoutingOptions.templateUrl=options.document.templateUrl,documentRoutingOptions.controller="engineDocumentWrapperCtrl",documentRoutingOptions.options=options,documentRoutingOptions.reloadOnSearch=!1;var listRoutingOptions={};_.isObject(listUrl)&&(listRoutingOptions=documentUrl),listRoutingOptions.templateUrl=options.list.templateUrl,listRoutingOptions.controller="engineListWrapperCtrl",listRoutingOptions.options=options,documents.push({list_route:listUrl,document_route:documentUrl}),$routeProvider.when(options.listUrl,listRoutingOptions),$routeProvider.when(options.documentUrl,documentRoutingOptions),documents_d[documentModelType]=options},this.subdocument=function(documentModelType,query,options){options=angular.merge(angular.copy(_defaultDocumentOptions),options),_apiCheck["throw"]([_apiCheck.string,_apiCheck.typeOrArrayOf(_apiCheck.string),_apiCheck.documentOptions],[documentModelType,query,options]),assert(options.document.steps.length>0,"options.document.steps has length == 0, please define at least one step for document"),prepareDocumentOptions(options),_checkDocumentOptions(options),options.query=query,options.subdocument=!0,documents_d[documentModelType]=options},this.formly=$engineFormlyProvider;var _baseUrl="";this.setBaseUrl=function(url){_baseUrl=url};var _visibleDocumentFields=[{name:"id",caption:"ID",type:"link",style:"monospace"},{name:"name",caption:"Name"}];this.setDocumentFields=function(documentFields){_visibleDocumentFields=documentFields},this.addDocumentFields=function(document_fields){document_fields instanceof Array?angular.forEach(document_fields,function(field){_visibleDocumentFields.push(field)}):_visibleDocumentFields.push(document_fields)},this._debug=!1,this.enableDebug=function(){self._debug=!0},this.disableDebug=function(){self._debug=!1},this.$get=["$engineFormly","engineDocument","$rootScope","$engLog","engineQuery","$injector",function($engineFormly,engineDocument,$rootScope,$engLog,engineQuery,$injector){var _engineProvider=self;return new function(){this.ERROR_HANDLER=_.isString(ERROR_HANDLER)?$injector.get(ERROR_HANDLER):ERROR_HANDLER,this.QUERY_PAGE_SIZE=QUERY_PAGE_SIZE,this.GLOBAL_CSS=GLOBAL_CSS,this.MODAL_CONTAINER=MODAL_CONTAINER,this.ON_METRIC_CHANGE=ON_METRIC_CHANGE,this.RESPONSIVE=RESPONSIVE,this.DOCUMENT_MODEL_KEY=DOCUMENT_MODEL_KEY,this.IMMEDIATE_CREATE=IMMEDIATE_CREATE,this.apiCheck=_apiCheck,this.formly=$engineFormly,this.baseUrl=_baseUrl,this.documents=documents,this.documents_d=documents_d,this.confirm=function(title,content){return _.isString(_engineProvider.confirmModal)?$injector.invoke([_engineProvider.confirmModal,function(_confirmModalMethod){return _confirmModalMethod(title,content)}]):_engineProvider.confirmModal(title,content)},this.disableOnReload=_engineProvider._disableOnReload,this.visibleDocumentFields=_visibleDocumentFields,this.getOptions=function(documentModelId){_apiCheck.string(documentModelId);var r=dashboards_d[documentModelId];return null!=r?r:documents_d[documentModelId]},this.enableDebug=function(){_engineProvider._debug=!0,$rootScope.$on("engine.common.error",function(event,errorEvent){_engineProvider._debug&&$engLog.error(errorEvent)})},this.disableDebug=function(){_engineProvider._debug=!1},this.pathToDocument=function(options,documentId){return _apiCheck([_apiCheck.documentOptions,_apiCheck.string.optional],arguments),document?options.document.url.replace(":id",documentId):options.document.documentUrl.replace(":id","new")},this.registerResourceProcessor=function(){},this.registerDocumentProcessor=function(processor){engineDocument.response_processors.push(processor),engineQuery.response_processors.push(processor)}}}]}]),angular.module("engine").factory("engineResolve",function(){function index(obj,i){if(null!=obj)return obj[i]}return function(baseObject,str){return str?str.split(".").reduce(index,baseObject):""}}).factory("$engResource",["$engineConfig",function($engineConfig){var engResource=function(){var defaults={browse:{method:"GET",transformResponse:transformResponse},query:{method:"GET",transformResponse:transformResponse,isArray:!0},get:{method:"GET",transformResponse:transformResponse},create:{method:"POST",transformRequest:transformRequest},update:{method:"PATCH",transformRequest:transformRequest},destroy:{method:"DELETE"}};angular.extend(defaults,options.methods);var resource=$resource($engineConfig.baseUrl+options.url,options.params,defaults);return resource};return engResource}]).service("engineQuery",["$engineConfig","$engLog","$engineApiCheck","$http","EngineInterceptor","$q",function($engineConfig,$engLog,$engineApiCheck,$http,EngineInterceptor,$q){var request_processors=[],response_processors=[];return{request_processors:request_processors,response_processors:response_processors,get:function(query,parentDocument,callback,errorCallback,skip,limit,sort,filters){$engineApiCheck["throw"]([$engineApiCheck.string,$engineApiCheck.object.optional,$engineApiCheck.func.optional,$engineApiCheck.func.optional,$engineApiCheck.number.optional,$engineApiCheck.number.optional,$engineApiCheck.array.optional,$engineApiCheck.any.optional],arguments);var parentDocumentId=null!=parentDocument&&null!=parentDocument.id?parentDocument.id:"",res=[];res.$resolved=0,$engLog.debug("searching",filters);var q=$http.post($engineConfig.baseUrl+"/query/documents-with-extra-data?queryId="+query+"&attachAvailableActions=true&otherDocumentId="+parentDocumentId+"&documentId="+parentDocumentId+(_.isUndefined(skip)||_.isUndefined(limit)?"":"&skip="+skip+"&limit="+limit)+(_.isUndefined(sort)||_.isEmpty(sort)?"":"&sort="+sort.join(","))+(_.isUndefined(filters)||_.isEmpty(filters)?"":"&constraints="+btoa(angular.toJson(filters)))).then(function(response){return response.data}).then(EngineInterceptor.response).then(function(data){return res=angular.merge(res,data)});return _.forEach(response_processors,function(processor){var processingQueue=[];q=q.then(function(documents){return _.forEach(documents,function(document,index){_.isNaN(parseInt(index))||processingQueue.push($q.when(processor(document.document)))}),$q.all(processingQueue).then(function(){return documents})})}),q=q.then(function(data){return res.$resolved=1,res},function(response){res.$resolved=2,res.$error=!0,res.$errorMessage=response.data.msg}).then(callback,errorCallback),res.$promise=q,res}}}]).service("engineDashboard",["$engineConfig","$engineApiCheck","$resource","EngineInterceptor",function($engineConfig,$engineApiCheck,$resource,EngineInterceptor){var _queryCategory=$resource($engineConfig.baseUrl+"/query?queryCategoryId=:queryCategoryId",{queryCategoryId:"@queryCategoryId"},{get:{method:"GET",transformResponse:EngineInterceptor.response,isArray:!0}});return{fromList:function(queryIds){$engineApiCheck([$engineApiCheck.arrayOf($engineApiCheck.string)],arguments)},fromCategory:function(queryCategoryId,callback,errorCallback){return $engineApiCheck([$engineApiCheck.string],arguments),_queryCategory.get({queryCategoryId:queryCategoryId},callback,errorCallback)}}}]).service("engineMetric",["$engineConfig","$engineApiCheck","$resource","EngineInterceptor",function($engineConfig,$engineApiCheck,$resource,EngineInterceptor){function metricSorter(data,headersGetter,status){var data=EngineInterceptor.response(data,headersGetter,status);return data=_.sortBy(data,"position")}var _query=$resource($engineConfig.baseUrl+"/metrics?documentId=:id",{id:"@id"},{post:{method:"POST",transformResponse:metricSorter,isArray:!0}});return function(options,callback,errorCallback){$engineApiCheck([$engineApiCheck.shape({documentJSON:$engineApiCheck.object,otherDocumentId:$engineApiCheck.string.optional}),$engineApiCheck.func.optional,$engineApiCheck.func.optional],arguments);var params={};return options.otherDocumentId&&(params.otherDocumentId=options.otherDocumentId),_query.post(params,_.omit(options.documentJSON,"$ext"),callback,errorCallback)}}]).service("engineMetricCategories",["$engineConfig","$engineApiCheck","$resource","EngineInterceptor","$engLog",function($engineConfig,$engineApiCheck,$resource,EngineInterceptor,$engLog){function collectMetrics(metrics){function writeMetric(_metric){_names[_metric.id]=_metric}function collectChildren(metric){angular.forEach(metric.children,function(_metric){writeMetric(_metric),collectChildren(_metric)})}angular.forEach(metrics,function(_metric){writeMetric(_metric),collectChildren(_metric)})}var _query=$resource($engineConfig.baseUrl+"/metric-categories",{},{get:{method:"GET",transformResponse:EngineInterceptor.response,isArray:!0}}),_metricCategories={},_names={},_promise=_query.get().$promise.then(function(data){return angular.forEach(data,function(metricCategory){_metricCategories[metricCategory.id]=metricCategory}),collectMetrics(data),$engLog.debug(_metricCategories),{$resolved:!0,metrics:_metricCategories,getNames:function(metricCategoryId){return metricCategoryId in _names||$engLog.error("You tried to access metricCategory which does not exist, check whether metric references existsing metric category. Wrong key: "+metricCategoryId),_names[metricCategoryId]}}});return _promise}]).service("engineActionsAvailable",["$engineConfig","$engineApiCheck","$resource","EngineInterceptor",function($engineConfig,$engineApiCheck,$resource,EngineInterceptor){var _action=$resource($engineConfig.baseUrl+"/action/available?documentId=:documentId",{documentId:"@id"},{post:{method:"POST",transformResponse:EngineInterceptor.response,isArray:!0}});return{forDocument:function(document,callback,errorCallback){return $engineApiCheck([$engineApiCheck.object,$engineApiCheck.func.optional,$engineApiCheck.func.optional],arguments),_action.post({documentId:document.id},document,callback,errorCallback)},forType:function(documentJson,parentDocumentId,callback,errorCallback){return _action.post({otherDocumentId:parentDocumentId},documentJson,callback,errorCallback)}}}]).service("engineAction",["$engineConfig","$engineApiCheck","$resource","EngineInterceptor",function($engineConfig,$engineApiCheck,$resource,EngineInterceptor){var _action=$resource($engineConfig.baseUrl+"/action/invoke?documentId=:documentId&actionId=:actionId&otherDocumentId=:otherDocumentId",{actionId:"@actionId",documentId:"@documentId",otherDocumentId:"@otherDocumentId"},{post:{method:"POST",transformResponse:EngineInterceptor.response,isArray:!1}});return function(actionId,document,callback,errorCallback,parentDocumentId,documentId){return $engineApiCheck([$engineApiCheck.string,$engineApiCheck.object,$engineApiCheck.func.optional,$engineApiCheck.func.optional],arguments),_action.post({actionId:actionId,documentId:documentId||document.id,otherDocumentId:parentDocumentId},document,callback,errorCallback)}}]).service("engineDocument",["$engineConfig","$engineApiCheck","$resource","EngineInterceptor","$http",function($engineConfig,$engineApiCheck,$resource,EngineInterceptor,$http){var _document=$resource("",{documentId:"@documentId"},{getDocument:{url:$engineConfig.baseUrl+"/document/getwithextradata?documentId=:documentId&attachAvailableActions=true",method:"POST",transformResponse:EngineInterceptor.response},validate:{url:$engineConfig.baseUrl+"/validate-metric-values?documentId=:documentId",method:"POST",transformResponse:EngineInterceptor.response}}),request_processors=[],response_processors=[];return{request_processors:request_processors,response_processors:response_processors,get:function(documentId,callback,errorCallback){$engineApiCheck([$engineApiCheck.string,$engineApiCheck.func.optional,$engineApiCheck.func.optional],arguments,errorCallback);var res={$resolved:0},q=$http.post($engineConfig.baseUrl+"/document/getwithextradata?documentId="+documentId+"&attachAvailableActions=true",null).then(function(response){return response.data}).then(EngineInterceptor.response).then(function(data){return res=angular.merge(res,data),res.document});return _.forEach(response_processors,function(processor){q=q.then(processor)}),q=q.then(function(data){return res.document=data,res.$resolved=1,res}).then(callback,errorCallback),res.$promise=q,res},validate:function(options,callback,errorCallback){return $engineApiCheck([$engineApiCheck.shape({document:$engineApiCheck.object,otherDocumentId:$engineApiCheck.string.optional}),$engineApiCheck.func.optional,$engineApiCheck.func.optional],arguments),_document.validate({documentId:options.document.id,otherDocumentId:options.otherDocumentId},options.document,callback,errorCallback)}}}]).service("EngineInterceptor",["$engLog",function($engLog){function processData(data){if(null!=data&&(void 0!==data.document&&(data=data.document),null!==data.metrics&&void 0!==data.metrics))for(var metric in data.metrics)data[metric]=data.metrics[metric]}return{response:function(data,headersGetter,status){if(angular.isString(data)){if(""==data)return{};data=angular.fromJson(data)}return data=data.data,data instanceof Array?angular.forEach(data,processData):processData(data),data},request:function(data,headersGetter){var site=data.site;return $engLog.log("parsing request"),site&&site.id&&(data.site=site.id,data.siteName=site.value.provider_id),angular.toJson(data)}}}]).service("MetricToFormly",function(){return function(data,headersGetter,status){}});var ENGINE_COMPILATION_DATE="2018-05-29T14:03:12.374Z",ENGINE_VERSION="0.8.18",ENGINE_BACKEND_VERSION="1.2.9",ENGINE_ENV="production",ENGINE_PRODUCTION_MODE="production"==ENGINE_ENV;angular.module("engine").constant("version",ENGINE_VERSION),angular.module("engine").constant("backendVersion",ENGINE_BACKEND_VERSION),angular.module("engine").constant("productionMode",ENGINE_PRODUCTION_MODE),angular.module("engine.formly").provider("$engineFormly",function(){var _typeTemplateUrls={input:"/src/formly/types/templates/input.tpl.html",attachment:"/src/formly/types/templates/attachment.tpl.html",attachmentList:"/src/formly/types/templates/attachmentList.tpl.html",select:"/src/formly/types/templates/select.tpl.html",checkbox:"/src/formly/types/templates/checkbox.tpl.html",radio:"/src/formly/types/templates/radio.tpl.html",radioGroup:"/src/formly/types/templates/radioGroup.tpl.html",
textarea:"/src/formly/types/templates/textarea.tpl.html",datepicker:"/src/formly/types/templates/datepicker.tpl.html",multiCheckbox:"/src/formly/types/templates/multiCheckbox.tpl.html",multiSelect:"/src/formly/types/templates/multiSelect.tpl.html",multiSelectImage:"/src/formly/types/templates/multiSelectImage.tpl.html",multiSelectVertical:"/src/formly/types/templates/multiSelectVertical.tpl.html"},_wrapperTemplateUrls={category:"/src/formly/wrappers/templates/category.tpl.html",label:"/src/formly/wrappers/templates/label.tpl.html",hasError:"/src/formly/wrappers/templates/has-error.tpl.html",step:"/src/formly/wrappers/templates/step.tpl.html",unit:"/src/formly/wrappers/templates/unit.tpl.html","default":"/src/formly/wrappers/templates/default.tpl.html"};this.templateUrls=_typeTemplateUrls,this.wrapperUrls=_wrapperTemplateUrls,this.setTypeTemplateUrl=function(type,url){_typeTemplateUrls[type]=url},this.setWrapperTemplateUrl=function(wrapper,url){_wrapperTemplateUrls[wrapper]=url},this.$get=function(){return new function(){this.templateUrls=_typeTemplateUrls,this.wrapperUrls=_wrapperTemplateUrls}}}),angular.module("engine.formly").run(["formlyConfig","$engineFormly","$engine","$engLog",function(formlyConfig,$engineFormly,$engine,$engLog){function camelize(string){return string=string.replace(/[\-_\s]+(.)?/g,function(match,chr){return chr?chr.toUpperCase():""}),string.replace(/^([A-Z])/,function(match,chr){return chr?chr.toLowerCase():""})}var attributes=["date-disabled","custom-class","show-weeks","starting-day","init-date","min-mode","max-mode","format-day","format-month","format-year","format-day-header","format-day-title","format-month-title","year-range","shortcut-propagation","datepicker-popup","show-button-bar","current-text","clear-text","close-text","close-on-date-selection","datepicker-append-to-body"],bindings=["datepicker-mode","min-date","max-date"],ngModelAttrs={};angular.forEach(attributes,function(attr){ngModelAttrs[camelize(attr)]={attribute:attr}}),angular.forEach(bindings,function(binding){ngModelAttrs[camelize(binding)]={bound:binding}}),$engLog.log(ngModelAttrs),formlyConfig.setType({name:"datepicker",templateUrl:$engineFormly.templateUrls.datepicker,wrapper:["engineLabel","engineHasError"],defaultOptions:{ngModelAttrs:ngModelAttrs,templateOptions:{datepickerOptions:{format:"dd-MM-yyyy",initDate:new Date,allowInvalid:!0},css:""}},controller:function($scope){$scope.openedDatePopUp=!1,$scope.today=function(){$scope.model[$scope.options.key]=new Date},$scope.openPopUp=function($event){$scope.openedDatePopUp=!0}}})}]),angular.module("engine.formly").run(["formlyConfig","$engineFormly","$engineApiCheck",function(formlyConfig,$engineFormly,$engineApiCheck){formlyConfig.setType({name:"input",templateUrl:$engineFormly.templateUrls.input,wrapper:["engineLabel","engineHasError"]}),formlyConfig.setType({name:"attachment",templateUrl:$engineFormly.templateUrls.attachment,wrapper:["engineLabel","engineHasError"]}),formlyConfig.setType({name:"attachmentList",templateUrl:$engineFormly.templateUrls.attachmentList,wrapper:["engineLabel","engineHasError"]}),formlyConfig.setType({name:"checkbox",templateUrl:$engineFormly.templateUrls.checkbox,wrapper:["engineHasError"]}),formlyConfig.setType({name:"radio",templateUrl:$engineFormly.templateUrls.radio,wrapper:["engineLabel","engineHasError"],defaultOptions:{noFormControl:!1,templateOptions:{className:"radioGroup"}}}),formlyConfig.setType({name:"radioGroup",templateUrl:$engineFormly.templateUrls.radioGroup,wrapper:["engineLabel","engineHasError"],defaultOptions:{noFormControl:!1,templateOptions:{className:"radioGroup"}}}),formlyConfig.setType({name:"multiSelect",templateUrl:$engineFormly.templateUrls.multiSelect,wrapper:["engineLabel","engineHasError"],defaultOptions:{noFormControl:!1}}),formlyConfig.setType({name:"multiSelectImage",templateUrl:$engineFormly.templateUrls.multiSelectImage,wrapper:["engineLabel","engineHasError"],defaultOptions:{noFormControl:!1}}),formlyConfig.setType({name:"multiSelectVertical",templateUrl:$engineFormly.templateUrls.multiSelectVertical,wrapper:["engineLabel","engineHasError"],defaultOptions:{noFormControl:!1}}),formlyConfig.setType({name:"select",templateUrl:$engineFormly.templateUrls.select,wrapper:["engineLabel","engineHasError"],defaultOptions:function(options){var ngOptions=options.templateOptions.ngOptions||"option[to.valueProp || 'value'] as option[to.labelProp || 'name'] group by option[to.groupProp || 'group'] for option in to.options",_options={ngModelAttrs:{}};return _options.ngModelAttrs[ngOptions]={value:options.templateOptions.optionsAttr||"ng-options"},_options}}),formlyConfig.setType({name:"textarea",templateUrl:$engineFormly.templateUrls.textarea,wrapper:["engineLabel","engineHasError"],defaultOptions:function(options){var _options={ngModelAttrs:{rows:{attribute:"rows"},cols:{attribute:"cols"}}};return _options}})}]),angular.module("engine.formly").config(["$engineFormlyProvider",function($engineFormlyProvider){$engineFormlyProvider.setWrapperTemplateUrl("row","/src/formly/wrappers/templates/row.tpl.html")}]).run(["formlyConfig","$engineFormly",function(formlyConfig,$engineFormly){formlyConfig.setWrapper({name:"row",templateUrl:$engineFormly.wrapperUrls.row})}]),angular.module("engine.formly").run(["formlyConfig","$engineFormly",function(formlyConfig,$engineFormly){formlyConfig.setWrapper({name:"engineLabel",templateUrl:$engineFormly.wrapperUrls.label,overwriteOk:!0}),formlyConfig.setWrapper({name:"engineHasError",templateUrl:$engineFormly.wrapperUrls.hasError,overwriteOk:!0}),formlyConfig.setWrapper({name:"category",templateUrl:$engineFormly.wrapperUrls.category}),formlyConfig.setWrapper({name:"step",templateUrl:$engineFormly.wrapperUrls.step}),formlyConfig.setWrapper({name:"unit",templateUrl:$engineFormly.wrapperUrls.unit}),formlyConfig.setWrapper({name:"default",templateUrl:$engineFormly.wrapperUrls["default"]})}]).controller("engineFormlyWrapperCtrl",["$scope","$engLog",function($scope,$engLog){$scope.$on("document.form.reloadingMetrics.before",function(event){$engLog.debug("document.form.reloadingMetrics.before"),$scope.loading=!0}),$scope.$on("document.form.reloadingMetrics.after",function(event){$engLog.debug("document.form.reloadingMetrics.after"),$scope.loading=!1})}]);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),app=angular.module("engine.list");app.component("filterInput",{bindings:{options:"<",column:"<",ngModel:"=",ngChange:"&"},templateUrl:"/src/list/filter/filter.component.tpl.html",controller:function(){function FilterInputControl(){_classCallCheck(this,FilterInputControl),this.openedDatePopUp=!1,this._choices=[],this._ngModel=void 0}return _createClass(FilterInputControl,[{key:"$onInit",value:function(){}},{key:"$onChanges",value:function(changes){changes.options&&changes.options.currentValue.choices&&(this._choices=this.addNoOption(changes.options.currentValue.choices))}},{key:"addNoOption",value:function(array){if(void 0!==array){var a=Array.from(array);return a.splice(0,0,{id:void 0,caption:""}),a}}},{key:"formatText",value:function(val){return val?{$regex:val,$options:"i"}:null}},{key:"formatDate",value:function(val){return null==val?null:{$regex:"^"+val.toISOString().substr(0,10)}}},{key:"formatChoice",value:function(val){return null==val?null:{$eq:val}}},{key:"_ngChange",value:function(val){this.ngModel=val,this.ngChange()}}]),FilterInputControl}()});var app=angular.module("engine.list");app.component("engineDocumentList",{template:"<ng-include src=\"$ctrl.contentTemplateUrl || '/src/list/list.component.tpl.html'\"></ng-include>",controller:"engineListCtrl",bindings:{immediateCreate:"<",options:"=",query:"=",formWidget:"@",parentDocument:"=",showCreateButton:"=",listCaption:"=",columns:"=",customButtons:"=",onSelectBehavior:"@",noDocumentsMessage:"@",noParentDocumentMessage:"@",metricId:"@",singleDocument:"=",controller:"@",contentTemplateUrl:"=",formlyOptions:"="}}),app.controller("engineListCtrl",["$scope","$route","$location","engineMetric","$engine","engineQuery","engineAction","engineActionsAvailable","engineActionUtils","engineResolve","DocumentModal","$engLog","DocumentActionList","$timeout","DocumentAction","$injector","$rootScope","$parse","$controller",function($scope,$route,$location,engineMetric,$engine,engineQuery,engineAction,engineActionsAvailable,engineActionUtils,engineResolve,DocumentModal,$engLog,DocumentActionList,$timeout,DocumentAction,$injector,$rootScope,$parse,$controller){function init(){null!==$scope.columns&&void 0!==$scope.columns||($scope.columns=[],$engine.visibleDocumentFields.forEach(function(field){void 0===field.caption&&void 0===field.id?$scope.columns.push({name:field}):$scope.columns.push(field)}),engineMetric({documentJSON:$scope.options.documentJSON},function(data){angular.forEach(data,function(metric){$scope.columns.push({name:metric.id,caption:metric.label})})})),self.loadDocuments()}var _this=this,self=this,_parentDocumentId=null;this.$onInit=function(){this.sort={column:null,direction:"-"},this.loadedOnce=!1,this.biggestDocumentSize=0,this.documentPages=[],this.currentPage=0,this.allDocumentsLoaded=!1,this.DOCUMENT_QUERY_LIMIT=$engine.QUERY_PAGE_SIZE,this.FILTER_DEBOUNCE_TIME=1e3,this.showFilters=!1,this.filters={},this.ordering=[],$scope.documentActions={},this.filterQueryAction=null,$scope.documents=[],self.engineResolve=engineResolve,this.formWidget="true"===this.formWidget,self.singleDocument?self.template="/src/list/list.single.tpl.html":self.template="/src/list/list.tpl.html",$scope.$parse=$parse,$scope.options=this.options,$scope.columns=this.columns,null!=$scope.options&&null!=$scope.options.document&&($scope.columns=this.columns||(this.metricId&&null!=$scope.options.document.queries&&null!=$scope.options.document.queries[this.metricId]?$scope.options.document.queries[this.metricId].columns:$scope.options.list.columns)),$scope.query=self.query,null==$scope.query&&null!=$scope.options&&null!=$scope.options.query&&($scope.query=$scope.options.query),$scope.customButtons=self.customButtons,null!=$scope.customButtons&&null!=$scope.options&&null!=$scope.options.customButtons&&($scope.customButtons=$scope.options.customButtons);for(var _loop=function(i){var customButton=$scope.customButtons[i];_.isString(customButton)?$injector.invoke([customButton,function(component){$scope.customButtons[i]=component}]):_.isFunction(customButton.refresh)&&customButton.refresh(),_.isString(customButton.callback)&&(callbackName=customButton.callback,customButton.callback=function(documentOptions){var returnVal=void 0;return $injector.invoke([callbackName,function(callback){returnVal=callback(documentOptions)}]),returnVal})},i=0;i<($scope.customButtons?$scope.customButtons.length:0);++i){var callbackName;_loop(i)}_parentDocumentId=this.parentDocument?this.parentDocument.id:void 0,$scope.actions=engineActionsAvailable.forType($scope.options.documentJSON,_parentDocumentId),$scope.documentActions={},$scope.$on("engine.list.reload",function(event,query){$engLog.debug("engine.list.reload received, reloading documents","queryId",$scope.query),self.loadDocuments(!0)}),init(),this.controller&&$controller(this.controller,{$scope:$scope})},this.canShowPagination=function(){return!(self.biggestDocumentSize<this.DOCUMENT_QUERY_LIMIT&&this.documentPages.length<=1)&&(this.noParentDocument!==!0&&(null==$scope.documents.$error&&!(!$scope.documents.$resolved&&!self.loadedOnce)))},this.sortByColumn=function(column){self.skip=0,_this.sort.column===column?"%2B"===_this.sort.direction?_this.sort.column=null:_this.sort.direction="%2B":_this.sort={column:column,direction:"-"},null===_this.sort.column?_this.ordering=[]:_this.ordering=[(_this.sort.column.filterKey||_this.sort.column.name)+_this.sort.direction],_this.loadDocuments(!0)},this.filterQuery=function(){$engLog.debug(this.filters),null!==this.filterQueryAction&&$timeout.cancel(this.filterQueryAction),this.filterQueryAction=$timeout(function(){self.loadDocuments(!0)},this.FILTER_DEBOUNCE_TIME)},this.setShowFilters=function(show){this.showFilters=show},this.calculateVirtualDocumentCount=function(){return $scope.documents.length%this.DOCUMENT_QUERY_LIMIT===0&&this.allDocumentsLoaded===!1?(this.documentPages.length+1)*this.DOCUMENT_QUERY_LIMIT:this.documentPages.length*this.DOCUMENT_QUERY_LIMIT},this.onPageChanged=function(){return this.currentPage>this.documentPages.length?void this.loadDocuments():void($scope.documents=this.documentPages[this.currentPage-1])},this.canShowInputFilterForColumn=function(column){return"@index"!==column.name&&column.filter!==!1},this.arrayCellIterate=function(iterator,array){return null==array?"":null==iterator?array.join(", "):_.map(array,function(element){return _.isFunction(iterator)?iterator(element):$parse(iterator)(element)}).join(", ")},this.process=function(processor,element){return null!=processor&&_.isFunction(processor)?processor(element):element},this.loadDocuments=function(clear){clear===!0&&($scope.documents=[],self.documentPages=[],self.currentPage=1,self.allDocumentsLoaded=!1);var filters=_.pick(this.filters,function(value){return null!=value});filters=_.isEmpty(filters)?null:{$and:_.map(filters,function(val,key){return _defineProperty({},key,val)})},null==this.parentDocument||null!=this.parentDocument&&null!=this.parentDocument.id?($scope.documents=engineQuery.get($scope.query,this.parentDocument,void 0,void 0,self.documentPages.length*self.DOCUMENT_QUERY_LIMIT,self.DOCUMENT_QUERY_LIMIT,this.ordering,filters),$scope.documents.$promise.then(function(documents){if(null!=documents){if(self.loadedOnce=!0,self.biggestDocumentSize=documents.length>self.biggestDocumentSize?documents.length:self.biggestDocumentSize,$scope.documents=documents,0===documents.length)return self.allDocumentsLoaded=!0,self.currentPage=self.documentPages.length,void(_.isEmpty(self.documentPages)||($scope.documents=_.last(self.documentPages)));self.documentPages.push($scope.documents),self.currentPage=self.documentPages.length,$scope.documents.length!==self.DOCUMENT_QUERY_LIMIT&&(self.allDocumentsLoaded=!0),angular.forEach(documents,function(document){$scope.documentActions[document.document.id]=new DocumentActionList(document.actions,document.document,self.parentDocument,$scope,(!0))}),null!=self.metricId&&(null==self.parentDocument.$ext&&(self.parentDocument.$ext={}),null==self.parentDocument.$ext.queries&&(self.parentDocument.$ext.queries={}),self.parentDocument.$ext.queries[self.metricId]=documents)}})):(this.noParentDocument=!0,$scope.documents={$resolved:1})},$scope.getActionsForDocument=function(documentEntry){return $scope.documentActions[documentEntry.document.id]},$scope.engineAction=function(action){return action.call().then(function(){$rootScope.$broadcast("engine.list.reload",$scope.query)})},$scope.renderCell=function(document,column){return document[column.name]},$scope.getCellTemplate=function(document,column,force_type){if(!force_type&&"link"==column.type)return"/src/list/cell/link.tpl.html";if(column.type){if("date"==column.type)return"/src/list/cell/date.tpl.html";if("array"==column.type)return"/src/list/cell/array.tpl.html"}return"@index"==column.name?"/src/list/cell/index.tpl.html":"/src/list/cell/text.tpl.html"},$scope.onDocumentSelect=function(documentEntry,$event){_parentDocumentId&&("LINK"==self.onSelectBehavior?$scope.getActionsForDocument(documentEntry).callLink().then(function(){$rootScope.$broadcast("engine.list.reload",$scope.query)}):1==$scope.options.subdocument&&DocumentModal(documentEntry.document.id,$scope.options,self.parentDocument,function(){$rootScope.$broadcast("engine.list.reload",$scope.query)}))},$scope.canGenerateHref=function(){return(!_parentDocumentId||"LINK"!==self.onSelectBehavior)&&$scope.options.subdocument!==!0},$scope.genDocumentLink=function(documentId,hash,column,document){var idExpression=documentId||$parse(column.id||"id")(document);return $scope.options.documentUrl&&$scope.canGenerateHref()?(1==hash?"#":"")+$scope.options.documentUrl.replace(":id",idExpression):""},$scope.onCreateDocument=function(){return console.log("onCreateDocument"),$scope.options.subdocument===!0?self.immediateCreate===!0?new DocumentAction(engineActionUtils.getCreateUpdateAction($scope.actions),$scope.options.documentJSON,self.parentDocument).call():DocumentModal(void 0,$scope.options,self.parentDocument,function(){return $rootScope.$broadcast("engine.list.reload",$scope.query)}):self.immediateCreate===!0?new DocumentAction(engineActionUtils.getCreateUpdateAction($scope.actions),$scope.options.documentJSON).call():void $location.path($scope.genDocumentLink("new"))},$scope.canCreateDocument=function(){return null!==engineActionUtils.getCreateUpdateAction($scope.actions)}}]),angular.module("engine.list").controller("engineListWrapperCtrl",["$scope","$route","engineDashboard","$engine",function($scope,$route,engineDashboard,$engine){$scope.options=$route.current.$$route.options,$scope.IMMEDIATE_CREATE=$engine.IMMEDIATE_CREATE;var query=$route.current.$$route.options.query;angular.isArray(query)?($scope.queries=[],angular.forEach(query,function(q){$scope.queries.push({id:q})})):engineDashboard.fromCategory(query,function(data){$scope.queries=[],angular.forEach(data,function(query){$scope.queries.push(query)})})}]);var app=angular.module("engine.list");app.directive("engSaveColWidth",["$timeout",function($timeout){var POSTLINK_TIMEOUT=1e3;return{restrict:"A",link:function(scope,element,attrs){$timeout(function(){jQuery(element).css("width",jQuery(element).width()+"px")},POSTLINK_TIMEOUT)}}}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/common/action-button/action-button.tpl.html",'<button type="submit"\n        class="btn {{$ctrl.btnClass || \'btn-default\'}}"\n        ng-click="$ctrl.invoke()">\n    <i class="fa fa-spinner fa-spin" aria-hidden="true" ng-show="$ctrl.loading"></i>\n    <translate translate="{{$ctrl.label}}"></translate>\n</button>')}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/common/confirm-modal/common.confirm-modal.tpl.html",'<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal" aria-hidden="true" ng-click="$ctrl.dismiss()">&times;</button>\n    <h4 class="modal-title" id="confirm-modal-label" translate>{{::$ctrl.resolve.title}}</h4>\n\n</div>\n<div class="modal-body" ng-bind-html="$ctrl.resolve.content | translate"></div>\n<div class="modal-footer">\n    <button class="btn btn-default" ng-click="$ctrl.dismiss()" translate>Cancel</button>\n    <button class="btn btn-primary" ng-click="$ctrl.close()" translate>Ok</button>\n</div>')}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/common/document-actions/document-actions.tpl.html",'<div class="eng-loading-box" ng-show="$ctrl.loading && $ctrl.steps.isLast($ctrl.step)">\n    <i class="fa fa-spinner fa-spin" aria-hidden="true"></i>\n</div>\n\n<button type="submit" class="btn btn-primary dark-blue-btn" ng-click="$ctrl.changeStep($ctrl.step+1)"\n        ng-if="$ctrl.steps.getSteps().length >= 1"\n        ng-show="!$ctrl.steps.isLast($ctrl.step)" translate>Next Step:</button>\n\n<button type="submit" class="btn btn-primary" ng-click="$ctrl.changeStep($ctrl.step+1)"\n        ng-if="$ctrl.steps.getSteps().length >= 1"\n        ng-show="!$ctrl.steps.isLast($ctrl.step)">\n    {{$ctrl.step+2}}. {{$ctrl.steps.getStep($ctrl.step+1).name}}\n</button>\n\n<span ng-if="$ctrl.saveAlertLeft == true" ng-show="!$ctrl.loading && $ctrl.dirty && $ctrl.steps.isLast($ctrl.step)" class="document-changes-info document-dirty-warning-left" translate>You must save document to perform actions</span>\n\n<!--Always show save button-->\n<action-button ng-show="$ctrl.actionList.getSaveAction() != null && $ctrl.dirty == true && !$ctrl.loading && $ctrl.steps.isLast($ctrl.step)"\n               on-click="$ctrl.actionList.callSave()" label="{{$ctrl.actionList.getSaveAction().label}}"></action-button>\n\n<!--Validate should be visible only on pristine document-->\n<action-button ng-show="$ctrl.dirty == false && !$ctrl.loading && $ctrl.actionList.getSaveAction()!=null && $ctrl.showValidationButton && $ctrl.steps.isLast($ctrl.step)"\n               on-click="$ctrl.validate()" label="Validate"></action-button>\n\n<!--Show all engine actions-->\n<action-button ng-repeat="action in $ctrl.actionList.actions" ng-show="$ctrl.dirty == false && !$ctrl.loading && $ctrl.steps.isLast($ctrl.step)"\n               on-click="action.call()" label="{{action.label}}"></action-button>\n\n<!--Show custom user actions-->\n<action-button ng-repeat="button in $ctrl.customButtons" ng-show="!$ctrl.loading && $ctrl.steps.isLast($ctrl.step)"\n               on-click="button.action()" label="{{button.label}}"></action-button>\n\n\n<span ng-if="$ctrl.saveAlertLeft == false" ng-show="!$ctrl.loading && $ctrl.dirty && $ctrl.steps.isLast($ctrl.step)" class="document-changes-info document-dirty-warning-right" translate>You must save document to perform actions</span>')}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/common/sidebar-addon/sidebar-addon.tpl.html",'<div scroll-rwd class="text-box sidebar-details">\n    <div class="text-content">\n        <h3 style="margin-top: 0" ng-if="caption">{{caption | translate}}</h3>\n\n    </div>\n</div>')}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/dashboard/dashboard.tpl.html",'<div class="row">\n    <div class="col-md-12">\n        <h1 translate>{{options.caption}}</h1>\n    </div>\n</div>\n<div class="text-box" ng-repeat="query in queries">\n    <div class="text-content">\n        <engine-document-list show-create-button="query.showCreateButton" columns="query.columns"\n                              custom-buttons="query.customButtons"\n                              content-template-url="query.contentTemplateUrl"\n                              controller="{{query.controller || \'\'}}"\n                              no-documents-message="{{query.noDocumentsMessage || $engine.getOptions(query.documentModelId).list.noDocumentsMessage || \'\'}}"\n                              no-parent-document-message="{{query.noParentDocumentMessage || $engine.getOptions(query.documentModelId).list.noParentDocumentMessage || \'\'}}"\n                              immediate-create="query.immediateCreate === true || (query.immediateCreate !== false && IMMEDIATE_CREATE === true)"\n                              query="query.queryId" options="$engine.getOptions(query.documentModelId)"\n                              list-caption="query.label"></engine-document-list>\n\n    </div>\n</div>')}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/document/details/details.tpl.html",'<div  scroll-rwd  is-visible="{{$ctrl.isVisible()}}" class="text-box sidebar-details">\n    <div class="text-content" ng-clock>\n        <h3 style="margin-top: 0px">{{$ctrl.options.document.details.caption || $ctrl.options.name}}</h3>\n\n        <span ng-show="$ctrl.dirty || $ctrl.ngModel.id == null" class="document-changes-info document-dirty" translate>Document has unsaved changes</span>\n        <span ng-show="!$ctrl.dirty && $ctrl.ngModel.id != null" class="document-changes-info document-pristine" translate>All changes have been saved</span>\n\n        <ul class="list-group">\n            <li ng-repeat="entry in $ctrl.options.document.details.entries | conditionFulfiled : $ctrl.ngModel" class="list-group-item">\n                <span translate>{{entry.caption || entry.name}}</span>\n                <span translate>{{$ctrl.formatEntry(entry) || \'Not specified yet\' | numberFormat}}</span>\n            </li>\n        </ul>\n\n        <action-button style="width: 100%" btn-class="btn-primary full-width" ng-if="$ctrl.actions.getSaveAction() != null"\n                       on-click="$ctrl.saveDocument()"\n                       label="{{$ctrl.options.document.details.saveCaption || \'Save\' }}">\n        </action-button>\n\n    </div>\n</div>')}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/document/document-modal.tpl.html",'<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal" aria-hidden="true" ng-click="closeModal()">&times;</button>\n    <h4 ng-if="!documentId" class="modal-title" id="myModalLabel" translate>{{ documentOptions.document.caption || \'CREATE \' + documentOptions.name }}</h4>\n    <h4 ng-if="documentId" ><span translate>{{documentOptions.name}}</span> {{engineResolve(document, documentOptions.document.titleSrc)}}</h4>\n\n</div>\n<div class="modal-body">\n    <div class="container-fluid">\n        <engine-document parent-document="parentDocument" dirty="documentDirty"\n                         document-scope="documentScope" step-list="stepList"\n                         document="document" document-id="{{documentId}}"\n                         step="step" options="documentOptions">\n        </engine-document>\n    </div>\n</div>\n<div class="modal-footer">\n    <engine-document-actions show-validation-button="documentOptions.document.showValidationButton" custom-buttons="customButtons"\n                             options="documentOptions"\n                             document="document" document-scope="documentScope" document-parent="parentDocument" dirty="documentDirty"\n                             steps="stepList" step="step" class="btn-group float-right" save-alert-left="true">\n    </engine-document-actions>\n</div>')}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/document/document.tpl.html",'<div class="eng-loading-box" ng-show="$ctrl.$ready.$$state.status === 0">\n    <i class="fa fa-spinner fa-spin" aria-hidden="true"></i>\n</div>\n\n<div ng-if="$ctrl.$ready.$$state.status === 1" ng-cloak>\n    <div ng-repeat="message in $ctrl.messages" class="alert alert-{{message.type}} alert-document" role="alert" translate>{{message.body}}</div>\n    <form ng-submit="$ctrl.onSubmit()" name="$ctrl.documentForm.formlyState" novalidate>\n        <formly-form model="$ctrl.document" fields="$ctrl.documentForm.formStructure" class="horizontal"\n                     options="$ctrl.formlyOptions" form="$ctrl.formlyState">\n\n            <engine-document-actions show-validation-button="$ctrl.showValidationButton" ng-if="!$ctrl.options.subdocument"\n                                     document="$ctrl.document" document-scope="$ctrl.documentScope" dirty="$ctrl.dirty"\n                                     actions="$ctrl.actions"\n                                     options="$ctrl.options"\n                                     steps="$ctrl.stepList" step="$ctrl.step" class="btn-group document-actions"\n                                  save-alert-left="false"></engine-document-actions>\n        </formly-form>\n    </form>\n</div>\n\n<div ng-show="!$ctrl.$ready.$$state.status === 2" ng-cloak translate>\n    REJECTED\n</div>')}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/document/document.wrapper.tpl.html",'<div>\n    <div class="row">\n        <div class="col-md-12">\n            <h1>\n                <span ng-if="!document.id" translate>{{ options.document.caption || \'CREATE \' + options.name }}</span>\n                <span ng-if="document.id" ><span translate>{{options.name}}</span>{{engineResolve(document, options.document.titleSrc)}}</span>\n\n                <span class="bold" ng-if="stepList.getSteps().length > 0">{{stepList.getStep($routeParams.step).name | translate}} {{$routeParams.step + 1}}/{{stepList.getSteps().length}}</span>\n            </h1>\n        </div>\n    </div>\n    <div class="row">\n        <engine-document step-list="stepList" show-validation-button="options.document.showValidationButton" processing="processing"\n                         document-id="{{::documentId}}" document="document" step="$routeParams.step" options="options"\n                         ng-class="{\'col-sm-8\': !responsive, \'col-xs-8\': !responsive, \'col-sm-12\': responsive, \'col-xs-12\': responsive}"\n                         class="col-lg-8 col-md-8 engine-document" actions="actions" dirty="documentDirty"></engine-document>\n        <div class="col-lg-4 col-md-4 sidebar-document"\n             ng-class="{\'hidden-sm\': responsive, \'hidden-xs\': responsive, \'col-sm-4\': !responsive, \'col-xs-4\': !responsive}">\n            <div fixed-on-scroll="fixed-sidebar-on-scroll">\n            <sidebar-addon ng-repeat="addon in options.document.sidebarAddons | filter: { position: \'top\' } | filter: conditionFulfilled" caption="{{::addon.caption}}" tag="{{::addon.component}}" document="document" ctx="addon.ctx"></sidebar-addon>\n            <engine-steps ng-model="document" processing="processing" step="$routeParams.step" step-list="stepList" options="options"></engine-steps>\n            <sidebar-addon ng-repeat="addon in options.document.sidebarAddons | filter: { position: \'middle\' } | filter: conditionFulfilled" caption="{{::addon.caption}}" tag="{{::addon.component}}" document="document" ctx="addon.ctx"></sidebar-addon>\n            <engine-document-details ng-model="document" options="options" actions="actions" dirty="documentDirty"></engine-document-details>\n            <sidebar-addon ng-repeat="addon in options.document.sidebarAddons | filter: { position: \'bottom\' } | filter: conditionFulfilled" caption="{{::addon.caption}}" tag="{{::addon.component}}" document="document" ctx="addon.ctx"></sidebar-addon>\n        </div>\n    </div>\n\n    <div class="document-navi-toggle hidden-md-up" ng-click="toggleSideMenu()" ng-if="responsive" ng-class="{active: sideMenuVisible}">\n        <i class="fa fa-file-text" aria-hidden="true"></i>\n    </div>\n    <div class="sidebar-document-rwd" ng-show="sideMenuVisible" ng-if="responsive">\n        <sidebar-addon ng-repeat="addon in options.document.sidebarAddons | filter: { position: \'top\' } | filter: conditionFulfilled" caption="{{::addon.caption}}" tag="{{::addon.component}}" document="document" ctx="addon.ctx"></sidebar-addon>\n        <engine-steps class="sidebar-box-shadow" ng-model="document" step="$routeParams.step" step-list="stepList" options="options"></engine-steps>\n        <sidebar-addon ng-repeat="addon in options.document.sidebarAddons | filter: { position: \'middle\' } | filter: conditionFulfilled" caption="{{::addon.caption}}" tag="{{::addon.component}}" document="document" ctx="addon.ctx"></sidebar-addon>\n        <engine-document-detail class="sidebar-box-shadow" ng-model="document" options="options" actions="actions" dirty="documentDirty"></engine-document-details>\n        <sidebar-addon ng-repeat="addon in options.document.sidebarAddons | filter: { position: \'bottom\' } | filter: conditionFulfilled" caption="{{::addon.caption}}" tag="{{::addon.component}}" document="document" ctx="addon.ctx"></sidebar-addon>\n    </div>\n\n</div>')}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/document/steps.tpl.html",'<div class="text-box text-box-nav">\n    <div ng-show="$ctrl.processing" class="category-loading">\n        <i class="category-loading-spinner fa fa-spinner fa-spin" style="" aria-hidden="true"></i>\n    </div>\n    <ul class="nav nav-pills nav-stacked nav-steps">\n        <li ng-repeat="_step in $ctrl.stepList.steps" ng-class="{active: $ctrl.stepList.getCurrentStep() == _step}">\n            <a href="" ng-click="$ctrl.changeStep($index)">\n                <span class="menu-icons">\n                    <i class="fa" aria-hidden="true" style="display: inline-block"\n                       ng-class="{\'fa-check-circle\' : _step.getState() == \'valid\',\n                                  \'fa-circle-o\': _step.getState() == \'blank\',\n                                  \'fa-cog fa-spin\': _step.getState() == \'loading\',\n                                  \'fa-times-circle\': _step.getState() == \'invalid\'}"></i>\n                </span>\n                <span class="menu-steps-desc ng-binding">{{$index + 1}}. {{_step.name}}</span>\n            </a>\n        </li>\n    </ul>\n</div>');
}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/formly/types/templates/attachment.tpl.html",'<div class="tpl-attachment">\n    <!--ng-model="model[options.key]"-->\n    <!--<input type="text" ng-model="username"><br/><br/>-->\n    <!--watching model:-->\n    <table>\n        <tr>\n            <th translate>Filename</th>\n            <th>Size</th>\n            <th class="attachment-actions">Actions</th>\n        </tr>\n        <tr ng-if="model[options.key]">\n            <td><a href="{{attachment.getDownloadLink()}}">{{ attachment.getFilename() }}</a></td>\n            <td>{{ attachment.getSize() | formatFileSize }}</td>\n            <td class="attachment-actions">\n                <a href="" class="" ng-click="delete()"><span class="fa fa-trash-o"></span></a>\n            </td>\n        </tr>\n\n    </table>\n\n    <button type="file" class="btn btn-primary btn-file"\n            ngf-model-invalid="invalidFile"\n            ngf-select="upload($file)"\n            ng-disabled="status != STATUS.normal"\n            ngf-multiple="false"\n            ngf-pattern="acceptedExtensions"\n            ngf-accept="acceptedExtensions"\n            ng-show="model[options.key] == null">\n        <i class="fa fa-cloud-upload" aria-hidden="true"></i>\n        <span ng-if="status == STATUS.uploading">{{ \'Uploading\' | translate}} {{progress}}%</span>\n        <span ng-if="status == STATUS.normal">{{ (attachment.label || \'Select File\') | translate}}</span>\n        <span ng-if="status == STATUS.disabled">{{ \'You must save document first\' | translate}}</span>\n    </button>\n    <p ng-if="error" class="error-text">{{error}}</p>\n</div>\n')}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/formly/types/templates/attachmentList.tpl.html",'<div class="tpl-attachment">\n    <!--ng-model="model[options.key]"-->\n    <!--<input type="text" ng-model="username"><br/><br/>-->\n    <!--watching model:-->\n    <table>\n        <tr>\n            <th translate>Filename</th>\n            <th>Size</th>\n            <th class="attachment-actions">Actions</th>\n        </tr>\n        <tr ng-if="model[options.key]" ng-repeat="file in model[options.key]">\n            <td><a href="{{attachment.getDownloadLink(file)}}">{{ attachment.getFilename(file) }}</a></td>\n            <td>{{ attachment.getSize(file) | formatFileSize }}</td>\n            <td class="attachment-actions">\n                <a href="" class="" ng-click="delete(file)"><span class="fa fa-trash-o"></span></a>\n            </td>\n        </tr>\n\n    </table>\n\n    <button type="file" class="btn btn-primary btn-file"\n            ngf-model-invalid="invalidFile"\n            ngf-select="upload($file)"\n            ng-disabled="status != STATUS.normal"\n            ngf-multiple="false"\n            ngf-pattern="acceptedExtensions"\n            ngf-accept="acceptedExtensions">\n        <i class="fa fa-cloud-upload" aria-hidden="true"></i>\n        <span ng-if="status == STATUS.uploading">{{ \'Uploading\' | translate}} {{progress}}%</span>\n        <span ng-if="status == STATUS.normal">{{ (attachment.label || \'Select File\') | translate}}</span>\n        <span ng-if="status == STATUS.disabled">{{ \'You must save document first\' | translate}}</span>\n    </button>\n    <p ng-if="error" class="error-text">{{error}}</p>\n</div>\n')}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/formly/types/templates/checkbox.tpl.html",'<div class="checkbox">\n\t<label>\n\t\t<input type="checkbox"\n           class="formly-field-checkbox"\n\t\t       ng-model="model[options.key]">\n\t\t{{to.label | translate}}\n\t\t{{to.required ? \'*\' : \'\'}}\n\t</label>\n</div>\n')}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/formly/types/templates/datepicker.tpl.html",'<p class="input-group input-group-datepicker">\n    <input id="{{::id}}"\n           name="{{::id}}"\n           ng-model="model[options.key]"\n           class="form-control datepicker"\n           type="text"\n           uib-datepicker-popup="{{to.datepickerOptions.format || \'yyyy-MM-dd\'}}"\n           is-open="openedDatePopUp"\n           datepicker-popup-template-url="/src/formly/types/templates/overrides/datepickerPopup.tpl.html"\n           ng-required="false"\n           show-button-bar="false"\n           datepicker-options="to.datepickerOptions"\n           on-open-focus="false"\n           placeholder="{{options.templateOptions.placeholder | translate}}"\n           ng-click="openPopUp($event)"/>\n    <span class="input-group-btn">\n        <button type="button" class="btn btn-default" ng-click="openPopUp($event)">\n            <i class="glyphicon glyphicon-calendar"></i>\n        </button>\n    </span>\n</p>')}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/formly/types/templates/input.tpl.html",'<input class="form-control"  ng-model="model[options.key]" placeholder="{{options.templateOptions.placeholder | translate}}" number-format>')}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/formly/types/templates/multiCheckbox.tpl.html",'<div class="radio-group">\n  <div ng-repeat="(key, option) in to.options" class="checkbox">\n    <label>\n      <input type="checkbox"\n             id="{{id + \'_\'+ $index}}"\n             ng-model="multiCheckbox.checked[$index]"\n             ng-change="multiCheckbox.change()">\n      {{option[to.labelProp || \'name\']}}\n    </label>\n  </div>\n</div>\n')}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/formly/types/templates/multiSelect.tpl.html",'<ui-select multiple ng-model="model[options.key]" ng-class="{\'disabled\': options.data.isDisabled()}" theme="bootstrap" class="multiple-ui-select">\n    <ui-select-match placeholder="Select option..." close-on-select="false">{{$item.value}}</ui-select-match>\n    <ui-select-choices repeat="option.value as option in to.options | filter:$select.search">\n        <div value="option.value"><span ng-bind-html="option.name">dddd</span>\n    </ui-select-choices>\n</ui-select>')}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/formly/types/templates/multiSelectImage.tpl.html",'<!--<div>\n    <div ng-repeat="option in to.options">\n        <input type="checkbox" id="{{id}}_{{::option.value}}" checklist-model="model[options.key]" checklist-value="option.value">\n        <label class="" style="top: -3px; position: relative;" for="{{id}}_{{::option.value}}">\n            <span class="" >{{::option.name}}</span>\n        </label>\n    </div>\n</div>-->\n\n<div>\n    <div class="content">\n        <div class="row">\n            <div ng-repeat="col in options.templateOptions.cols" class="{{::options.templateOptions.colClass}}">\n               <div class="multiselect-image {{::element.css}} {{options.data.isActive(element.value) ? \'alert-success\' : \'alert-default\'}} form-control"\n                     role="alert" ng-repeat="element in col"\n                     ng-class="{\'disabled\': options.data.isDisabled()}"\n                     ng-click="options.data.isDisabled() || addRemoveModel(element.value)">\n                    <span>{{::element.label}}</span>\n                    <i class="fa fa-check-circle" aria-hidden="true"></i>\n                </div>\n            </div>\n            <!-- we need ng-model for proper usage of multiSelectImage by formly -->\n            <input type="hidden" ng-model="model">\n        </div>\n    </div>\n</div>\n')}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/formly/types/templates/multiSelectVertical.tpl.html",'<div>\n    <div ng-repeat="option in to.options">\n        <input ng-disabled="options.data.isDisabled()" ng-class="{\'disabled\': options.data.isDisabled()}"\n               type="checkbox" id="{{id}}_{{::option.value}}" checklist-model="model[options.key]" checklist-value="option.value">\n        <label class="" style="top: -3px; position: relative;" for="{{options.data.isDisabled()?\'\':id+\'_\'+option.value}}">\n            <span class="" >{{::option.name}}</span>\n        </label>\n    </div>\n</div>')}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/formly/types/templates/overrides/datepickerPopup.tpl.html",'<ul role="presentation" class="uib-datepicker-popup dropdown-menu uib-position-measure engine-popup" dropdown-nested ng-if="isOpen" ng-keydown="keydown($event)" ng-click="$event.stopPropagation()">\n    <li ng-transclude></li>\n    <li ng-if="showButtonBar" class="uib-button-bar">\n    <span class="btn-group pull-left">\n      <button type="button" class="btn btn-sm btn-info uib-datepicker-current" ng-click="select(\'today\', $event)" ng-disabled="isDisabled(\'today\')">{{ getText(\'current\') }}</button>\n      <button type="button" class="btn btn-sm btn-danger uib-clear" ng-click="select(null, $event)">{{ getText(\'clear\') }}</button>\n    </span>\n        <button type="button" class="btn btn-sm btn-success pull-right uib-close" ng-click="close($event)">{{ getText(\'close\') }}</button>\n    </li>\n</ul>')}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/formly/types/templates/radio.tpl.html",'<div class="radio-group">\n  <div ng-repeat="(key, option) in to.options" class="radio">\n    <label class="radio-label">\n      <input type="radio"\n             id="{{id + \'_\'+ $index}}"\n             tabindex="0"\n             ng-value="option[to.valueProp || \'value\']"\n             ng-model="model[options.key]">\n      <span class="radio-label">{{option[to.labelProp || \'name\']}}<span>\n    </label>\n  </div>\n</div>\n')}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/formly/types/templates/radioGroup.tpl.html",'<div>\n    <div class="pr-category btn-group row row-compensate">\n            <label class="btn btn-radio btn-default" ng-repeat="(key, option) in to.options">\n                <input type="radio"\n                       class="radio-group-button"\n                       id="{{id + \'_\'+ $index}}"\n                       tabindex="0"\n                       ng-value="option[to.valueProp || \'value\']"\n                       ng-model="model[options.key]">\n                <span class="radio-desc" translate>{{option[to.labelProp || \'name\']}}</span>\n            </label>\n    </div>\n</div>')}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/formly/types/templates/select.tpl.html",'<select class="form-control" ng-model="model[options.key]"></select>')}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/formly/types/templates/textarea.tpl.html",'<textarea class="form-control engine-input" ng-model="model[options.key]" placeholder="{{options.templateOptions.placeholder | translate}}"></textarea>')}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/formly/wrappers/templates/category.tpl.html",'<div class="{{options.templateOptions.wrapperClass}}" style="position: relative" ng-show="options.data.hasMetrics()" ng-controller="engineFormlyWrapperCtrl">\n    <div ng-show="loading" class="category-loading">\n        <i class="category-loading-spinner fa fa-spinner fa-spin" style="" aria-hidden="true"></i>\n    </div>\n    <div class="{{::options.templateOptions.wrapperInnerClass}}">\n        <h2 ng-if="options.templateOptions.label" translate>{{options.templateOptions.label}}</h2>\n        <formly-transclude></formly-transclude>\n    </div>\n    <div class=clearfix"></div>\n</div>')}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/formly/wrappers/templates/default.tpl.html",'<div class="{{::options.to.categoryWrapperCSS}}">\n    <formly-transclude></formly-transclude>\n</div>')}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/formly/wrappers/templates/has-error.tpl.html",'<div class="form-group" ng-class="{\'has-error\': showError }">\n  <formly-transclude></formly-transclude>\n  <div ng-if="showError" class="error-messages">\n    <div ng-repeat="(key, error) in fc.$error" class="message help-block ng-binding ng-scope" translate>{{options.validation.messages[key](fc.$viewValue, fc.$modelValue, this)}}</div>\n  </div>\n  <!-- after researching more about ng-messages integrate it\n  <div ng-messages="fc.$error" ng-if="showError" class="error-messages">\n    <div ng-message="{{ ::name }}" ng-repeat="(name, message) in ::options.validation.messages" class="message help-block ng-binding ng-scope" translate>{{ message(fc.$viewValue, fc.$modelValue, this)}}</div>\n  </div>\n  -->\n</div>\n')}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/formly/wrappers/templates/label.tpl.html",'<div class="">\n    <label for="{{id}}" class="control-label {{to.labelSrOnly ? \'sr-only\' : \'\'}}" ng-if="to.label">\n        <span class="eng-text-label" translate>{{to.label}}</span>\n        <span class="text-danger">{{options.data.metric.required ? \'*\' : \'\'}}</span>\n        <span translate class="grey-text" ng-if="to.description" translate>({{to.description}})</span>\n    </label>\n    <formly-transclude></formly-transclude>\n</div>\n')}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/formly/wrappers/templates/row.tpl.html",'<div ng-if="options.data.hasMetrics()">\n    <p class="row-label" ng-if="to.label" translate>{{to.label}}</p>\n    <div class="row  {{options.templateOptions.wrapperClass}}">\n        <formly-transclude></formly-transclude>\n    </div>\n</div>')}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/formly/wrappers/templates/step.tpl.html",'<div ng-hide="options.data.hide">\n    <div class="text-box" ng-if="options.data.hasEntries()">\n        <div class="{{::options.templateOptions.wrapperInnerClass}}">\n            <h2 ng-if="options.data.step.data.summary.caption" translate>{{options.data.step.data.summary.caption}}</h2>\n            <table class="table">\n                <tr ng-repeat="entry in options.data.step.data.summary.entries">\n                    <td translate>{{entry.caption || entry.name}}</td>\n                    <td translate>{{options.data.$parse(entry.name)(model) || \'Not specified yet\'}}</td>\n                </tr>\n            </table>\n        </div>\n        <div class=clearfix"></div>\n    </div>\n    <formly-transclude></formly-transclude>\n</div>')}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/formly/wrappers/templates/unit.tpl.html",'<div class="input-group">\n    <formly-transclude></formly-transclude>\n    <span class="input-group-addon" ng-bind-html="::options.data.unit"></span>\n</div>')}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/list/cell/array.tpl.html","{{$ctrl.arrayCellIterate(column.iterator,\n                         $ctrl.process(column.processor, $parse(column.name)(document_entry.document)))}}")}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/list/cell/date.tpl.html","{{$ctrl.process(column.processor, $parse(column.name)(document_entry.document)) | date}}")}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/list/cell/index.tpl.html","{{$ctrl.process(column.processor, (($ctrl.currentPage - 1) * $ctrl.DOCUMENT_QUERY_LIMIT) + $row+1)}}")}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/list/cell/link.tpl.html",'<a ng-href="{{::genDocumentLink(null, true, column, document_entry.document)}}" ng-click="onDocumentSelect(document_entry)" class="proposal-title" ng-include="getCellTemplate(document_entry.document, column, true)"></a>')}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/list/cell/text.tpl.html","{{$ctrl.process(column.processor, $parse(column.name)(document_entry.document)) | numberFormat}}")}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/list/filter/filter.component.tpl.html",'<input ng-if="$ctrl.options.type === \'text\' || $ctrl.options.type === \'link\'"\n       ng-change="$ctrl._ngChange($ctrl.formatText($ctrl._ngModel))"\n       ng-model="$ctrl._ngModel"\n       type="text"\n       class="form-control input-sm eng-table-filter-header-input" />\n\n<input ng-if="$ctrl.options.type === \'date\'"\n       ng-change="$ctrl._ngChange($ctrl.formatDate($ctrl._ngModel))"\n       ng-model="$ctrl._ngModel"\n       type="text"\n       uib-datepicker-popup="dd-MM-yyyy"\n       ng-model-options="{timezone: \'+0000\'}"\n       datepicker-popup-template-url="/src/formly/types/templates/overrides/datepickerPopup.tpl.html"\n       show-button-bar="false"\n       on-open-focus="false"\n       is-open="$ctrl.openedDatePopUp"\n       ng-click="$ctrl.openedDatePopUp = !$ctrl.openedDatePopUp"\n       class="form-control eng-table-filter-header-input datepicker" />\n\n<select ng-if="$ctrl.options.type === \'choice\'"\n        class="form-control input-sm eng-table-filter-header-input"\n        ng-change="$ctrl._ngChange($ctrl.formatChoice($ctrl._ngModel))"\n        ng-model="$ctrl._ngModel"\n        ng-options="op.id as op.caption | translate for op in $ctrl._choices">\n</select>\n\n')}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/list/list.component.tpl.html",'<ng-include src="$ctrl.template"></ng-include>')}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/list/list.single.tpl.html",'<h2 ng-if="$ctrl.listCaption" translate>{{ $ctrl.listCaption }}</h2>\n<div>\n    <div class="eng-loading-box" ng-show="!documents.$resolved">\n        <i class="fa fa-spinner fa-spin" aria-hidden="true"></i>\n    </div>\n    <div ng-if="documents.$resolved || $ctrl.noParentDocument" ng-cloak>\n        <table ng-repeat="document_entry in documents" ng-if="!documents.$error && !$ctrl.noParentDocument"\n               ng-init="$row=$index" class="proposal-list">\n            <thead>\n            <tr class="single-document-top">\n                <td class="text-left"></td>\n                <td class="text-right cog-dropdown" style="padding-top: 5px">\n                    <div class="dropdown" style="height: 9px;"\n                         ng-if="getActionsForDocument(document_entry).actions.length > 0">\n                        <a href="" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"\n                           aria-expanded="true"><span class="glyphicon glyphicon-cog"></span></a>\n                        <ul class="dropdown-menu">\n                            <li ng-repeat="action in getActionsForDocument(document_entry).actions">\n                                <a href=""\n                                   ng-click="engineAction(action)"\n                                   translate>{{action.label}}</a>\n                            </li>\n                            <li ng-if="!getActionsForDocument(document_entry).actions"><span\n                                    style="margin-left: 5px; margin-right: 5px;" translate>No actions available</span>\n                            </li>\n                        </ul>\n                    </div>\n                </td>\n            </tr>\n            </thead>\n            <tbody>\n            <tr ng-repeat="column in columns | conditionFulfiled : document_entry.document" class="{{column.css}} {{column.style}}">\n                <td class="{{column.css_header || column.css}}" style="text-transform: uppercase;" translate>\n                    {{column.caption || column.name}}\n                </td>\n                <td ng-include="getCellTemplate(document_entry.document, column)"></td>\n            </tr>\n            </tbody>\n        </table>\n\n        <div class="alert alert-warning" role="alert" ng-if="documents.$error" translate>\n            {{documents.$errorMessage || \'An error occurred during document loading\'}}\n        </div>\n        <div class="alert alert-warning" role="alert" ng-if="$ctrl.noParentDocument" translate>\n            {{$ctrl.noParentDocumentMessage || \'Parent document does not exist, save this document first\'}}\n        </div>\n        <div class="alert alert-info" role="alert"\n             ng-if="documents.$resolved && documents.length == 0 && !documents.$error" translate>\n            {{ $ctrl.noDocumentsMessage || \'There are no documents to display\'}}\n        </div>\n    </div>\n</div>\n\n<action-button ng-if="$ctrl.showCreateButton !== false && canCreateDocument()"\n               btn-class="btn-primary" on-click="onCreateDocument()"\n               label="{{$ctrl.options.list.createButtonLabel ? $ctrl.options.list.createButtonLabel : \'Create \'+options.name}}"></action-button>\n\n<action-button ng-repeat="customButton in customButtons"\n               btn-class="btn-primary" on-click="customButton.callback($ctrl.options)"\n               label="{{customButton.label}}"></action-button>\n')}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/list/list.tpl.html",'<ng-form eng-isolate-form>\n    <h2 ng-show="$ctrl.listCaption" class="eng-list-header"><span\n            class="eng-caption" ng-if="$ctrl.listCaption" translate>{{ $ctrl.listCaption }}</span>\n        <div class="pull-right">\n            <ul uib-pagination\n                ng-show="$ctrl.canShowPagination()"\n                style="margin-top: 0px;"\n                class="pagination-sm eng-list-pagination-top"\n                total-items="$ctrl.calculateVirtualDocumentCount()"\n                items-per-page="$ctrl.DOCUMENT_QUERY_LIMIT"\n                boundry-links="false"\n                max-size="6"\n                rotate="true"\n                ng-model="$ctrl.currentPage"\n                ng-change="$ctrl.onPageChanged()">\n            </ul>\n        </div>\n\n        <button ng-show="$ctrl.canShowPagination()"\n                class="btn btn-default btn-sm pull-right list-filter"\n                ng-class="{active: $ctrl.showFilters === true}"\n                ng-click="$ctrl.setShowFilters(!$ctrl.showFilters)"\n                title="{{ \'Filter\' | translate}}">\n            <span class="glyphicon glyphicon-filter"></span>\n        </button>\n    </h2>\n\n    <div class="eng-loading-box clear" ng-show="!documents.$resolved">\n        <i class="fa fa-spinner fa-spin" aria-hidden="true"></i>\n    </div>\n    <div class="clear" ng-if="$ctrl.loadedOnce || documents.$resolved || $ctrl.noParentDocument" ng-cloak>\n        <table class="proposal-list table">\n            <thead>\n            <tr>\n                <th class="{{column.css_header || column.css}} engine-table-header" style="text-transform: uppercase;"\n                    eng-save-col-width\n                    ng-class="{\'eng-col-index\': column.name === \'@index\'}"\n                    ng-repeat="column in columns">\n                    <span ng-class="{\'table-header-sort\': column.name !== \'@index\'}" ng-click="$ctrl.sortByColumn(column)">\n                        <span translate>{{column.caption || column.name}}</span>\n                        <span class="glyphicon"\n                              ng-class="{\'glyphicon-chevron-up\': $ctrl.sort.column === column && $ctrl.sort.direction === \'%2B\', \'glyphicon-chevron-down\': $ctrl.sort.column === column && $ctrl.sort.direction === \'-\'}">\n                        </span>\n                    </span>\n                    <filter-input\n                            ng-show="$ctrl.showFilters === true"\n                            ng-change="$ctrl.filterQuery()"\n                            ng-if="$ctrl.canShowInputFilterForColumn(column)"\n                            column="column"\n                            options="{choices: column.filterChoices, type: column.filterChoices != null ? \'choice\' : (column.type || \'text\')}"\n                            ng-model="$ctrl.filters[column.filterKey || column.name]">\n                    </filter-input>\n                </th>\n                <th class="text-right eng-cog-col"></th>\n            </tr>\n            </thead>\n            <tbody>\n            <tr ng-if="documents.$resolved && documents.length == 0 && !documents.$error" class="query-info">\n                <td colspan="{{::columns.length + 1}}" translate>\n                    {{ $ctrl.noDocumentsMessage || \'There are no documents to display\'}}\n                </td>\n            </tr>\n            <tr ng-repeat="document_entry in documents" ng-if="!documents.$error && !$ctrl.noParentDocument"\n                ng-init="$row=$index">\n                <td ng-repeat="column in columns" class="{{column.css}} {{column.style}}"\n                    ng-include="getCellTemplate(document_entry.document, column)"></td>\n                <td class="text-right cog-dropdown eng-cog-col">\n                    <div class="dropdown" ng-if="getActionsForDocument(document_entry).actions.length > 0">\n                        <a href="" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"\n                           aria-expanded="true"><i\n                                class="fa fa-cog" aria-hidden="true"></i></a>\n                        <ul class="dropdown-menu">\n                            <li ng-repeat="action in getActionsForDocument(document_entry).actions">\n                                <a href=""\n                                   ng-click="engineAction(action)"\n                                   translate>{{action.label}}</a>\n                            </li>\n                            <li ng-if="!getActionsForDocument(document_entry).actions"><span\n                                    style="margin-left: 5px; margin-right: 5px;" translate>No actions available</span>\n                            </li>\n                        </ul>\n                    </div>\n                </td>\n            </tr>\n            </tbody>\n        </table>\n        <div class="alert alert-warning" role="alert" ng-if="documents.$error" translate>\n            {{documents.$errorMessage || \'An error occurred during document loading\'}}\n        </div>\n        <div class="alert alert-warning" role="alert" ng-if="$ctrl.noParentDocument" translate>\n            {{$ctrl.noParentDocumentMessage || \'Parent document does not exist, save this document first\'}}\n        </div>\n        <!--<div class="alert alert-info" role="alert"-->\n        <!--ng-if="documents.$resolved && documents.length == 0 && !documents.$error"-->\n        <!--translate>-->\n        <!--{{ $ctrl.noDocumentsMessage || \'There are no documents to display\'}}-->\n        <!--</div>-->\n        <div ng-if="$ctrl.formlyOptions.templateOptions.serverErrors!=0"\n             ng-repeat="error in $ctrl.formlyOptions.templateOptions.serverErrors">\n            <div class="alert alert-danger"><span translate>{{ error }}</span></div>\n        </div>\n    </div>\n\n    <div class="eng-list-bottom-bar"\n         ng-if="customButtons || ($ctrl.showCreateButton !== false && canCreateDocument()) || $ctrl.canShowPagination()">\n        <action-button ng-if="$ctrl.showCreateButton !== false && canCreateDocument()"\n                       ng-show="documents.$resolved"\n                       btn-class="btn-primary" on-click="onCreateDocument()"\n                       label="{{$ctrl.options.list.createButtonLabel ? $ctrl.options.list.createButtonLabel : \'Create \'+options.name }}"></action-button>\n\n        <action-button ng-repeat="customButton in customButtons"\n                       ng-show="documents.$resolved && customButton.callback"\n                       btn-class="btn-primary" on-click="customButton.callback($ctrl.options)"\n                       label="{{customButton.label | translate}}"></action-button>\n\n\n        <ul uib-pagination\n            ng-show="$ctrl.canShowPagination()"\n            style="margin-top: 0px;"\n            class="pagination-sm pull-right"\n            total-items="$ctrl.calculateVirtualDocumentCount()"\n            items-per-page="$ctrl.DOCUMENT_QUERY_LIMIT"\n            boundry-links="false"\n            rotate="true"\n            ng-model="$ctrl.currentPage"\n            ng-change="$ctrl.onPageChanged()">\n        </ul>\n    </div>\n</ng-form>')}]),angular.module("engine").run(["$templateCache",function($templateCache){$templateCache.put("/src/list/list.wrapper.tpl.html",'<h1 translate>{{::options.list.caption}}</h1>\n<div class="text-box" ng-repeat="query in queries">\n    <div class="text-content">\n        <engine-document-list content-template-url="query.contentTemplateUrl"\n                controller="{{query.controller || \'\'}}"\n                no-documents-message="{{query.noDocumentsMessage || options.list.noDocumentsMessage || \'\'}}"\n                no-parent-document-message="{{query.noParentDocumentMessage || options.list.noParentDocumentMessage || \'\'}}"\n                immediate-create="query.immediateCreate === true || (query.immediateCreate !== false && IMMEDIATE_CREATE === true)"\n                show-create-button="$last" query="query.id" options="options"></engine-document-list>\n    </div>\n</div>')}]);